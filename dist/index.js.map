{"version":3,"sources":["webpack://toru/webpack/universalModuleDefinition","webpack://toru/./src/shaders/material.frag.glsl","webpack://toru/./src/shaders/material.vert.glsl","webpack://toru/./src/shaders/material_sphere.frag.glsl","webpack://toru/./src/shaders/material_sphere.vert.glsl","webpack://toru/./src/shaders/simple.frag.glsl","webpack://toru/./src/shaders/simple.vert.glsl","webpack://toru/./src/shaders/sprite.frag.glsl","webpack://toru/./src/shaders/sprite.vert.glsl","webpack://toru/./src/shaders/wireframe.frag.glsl","webpack://toru/./src/shaders/wireframe.vert.glsl","webpack://toru/./src/actor.ts","webpack://toru/./src/camera.ts","webpack://toru/./src/component.ts","webpack://toru/./src/components/light.ts","webpack://toru/./src/components/static_mesh.ts","webpack://toru/./src/geom.ts","webpack://toru/./src/index.ts","webpack://toru/./src/light.ts","webpack://toru/./src/material.ts","webpack://toru/./src/mesh.ts","webpack://toru/./src/meshes/cube.ts","webpack://toru/./src/meshes/obj.ts","webpack://toru/./src/meshes/quad.ts","webpack://toru/./src/meshes/sphere.ts","webpack://toru/./src/render_texture.ts","webpack://toru/./src/renderer/index.ts","webpack://toru/./src/renderer/renderer.ts","webpack://toru/./src/renderer/webgl_mesh.ts","webpack://toru/./src/renderer/webgl_render_target.ts","webpack://toru/./src/renderer/webgl_renderer.ts","webpack://toru/./src/renderer/webgl_shader.ts","webpack://toru/./src/renderer/webgl_texture.ts","webpack://toru/./src/scene.ts","webpack://toru/./src/shader.ts","webpack://toru/./src/shaders/material.ts","webpack://toru/./src/shaders/simple.ts","webpack://toru/./src/shaders/sprite.ts","webpack://toru/./src/texture.ts","webpack://toru/webpack/bootstrap","webpack://toru/webpack/runtime/define property getters","webpack://toru/webpack/runtime/hasOwnProperty shorthand","webpack://toru/webpack/runtime/make namespace object","webpack://toru/webpack/startup"],"names":[],"mappings":"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C,GAAC,CAAC,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YAChB,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEjB,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YACxB,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YAChB,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YAChB,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEjB,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YACzB,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC;YACf,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,EAAE,CAAC,G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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"toru\"] = factory();\n\telse\n\t\troot[\"toru\"] = factory();\n})(self, function() {\nreturn ","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nstruct Material {\\n\\tbool castsShadows;\\n\\tbool receivesShadows;\\n\\tbool hasTexture;\\n\\tbool hasNormalMap;\\n\\tbool hasSpecularMap;\\n\\tbool hasDisplacementMap;\\n\\tbool emissive;\\n\\tvec4 color;\\n\\tfloat displacementMultiplier;\\n\\tsampler2D texture;\\n\\tsampler2D normalMap;\\n\\tsampler2D specularMap;\\n\\tsampler2D displacementMap;\\n};\\n\\nstruct Light {\\n\\tvec3 position;\\n\\tvec3 ambient;\\n\\tvec3 diffuse;\\n\\tvec3 specular;\\n\\n\\tfloat constant;\\n\\tfloat linear;\\n\\tfloat quadratic;\\n};\\n\\nuniform mat4 uModel;\\nuniform vec4 uFillColor;\\nuniform mat4 uView;\\nuniform sampler2D uShadowMap;\\nuniform vec3 uLightDir;\\nuniform Material uMaterial;\\nuniform int uLightCount;\\nuniform Light uLights[32];\\n\\nvarying vec3 vNormal;\\nvarying vec3 vViewNormal;\\nvarying vec4 vPosition;\\nvarying vec2 vTexCoord;\\nvarying vec4 vPositionInLight;\\n\\nvoid main(void) {\\n\\tvec3 texNormal;\\n\\tif (uMaterial.hasNormalMap) {\\n\\t\\ttexNormal = normalize(vec4(normalize(vNormal) * texture2D(uMaterial.normalMap, vTexCoord).rgb, 0.0) * uModel * uView).xyz;\\n\\t}\\n\\telse {\\n\\t\\ttexNormal = normalize(vec4(normalize(vNormal), 0.0) * uModel * uView).xyz;\\n\\t}\\n\\tvec4 texColor;\\n\\tif (uMaterial.hasTexture) {\\n\\t\\ttexColor = texture2D(uMaterial.texture, vTexCoord);\\n\\t} else {\\n\\t\\ttexColor = uMaterial.color;\\n\\t}\\n\\tfloat texSpecular = 0.0;\\n\\tif (uMaterial.hasSpecularMap) {\\n\\t\\ttexSpecular = texture2D(uMaterial.specularMap, vTexCoord).r;\\n\\t}\\n\\n\\tif (uMaterial.emissive) {\\n\\t\\tgl_FragColor = texColor;\\n\\t\\treturn;\\n\\t}\\n\\n\\tvec4 vertPos4 = vPosition * uView;\\n\\tvec3 vertPos = vertPos4.xyz / vertPos4.w;\\n\\n\\tvec3 ambient = vec3(0.0);\\n\\tvec3 diffuse = vec3(0.0);\\n\\tvec3 specular = vec3(0.0);\\n\\n\\tfor (int i = 0; i < 32; i++) {\\n\\t\\tif (i >= uLightCount) break;\\n\\n\\t\\tvec4 lightPos4 = vec4(uLights[i].position, 1.0) * uView;\\n\\t\\tvec3 lightPos = lightPos4.xyz / lightPos4.w;\\n\\n\\t\\tvec3 lightDir = normalize(lightPos - vertPos);\\n\\t\\tvec3 lightColor = uLights[i].diffuse;\\n\\t\\tambient += uLights[i].ambient;\\n\\n\\t\\tfloat diff = max(dot(texNormal, lightDir), 0.0);\\n\\t\\tdiffuse += diff * lightColor;\\n\\n\\t\\tfloat lambertian = max(dot(texNormal, lightDir), 0.0);\\n\\t\\tfloat spec = 0.0;\\n\\n\\t\\tif (lambertian > 0.0) {\\n\\t\\t\\tvec3 reflectDir = reflect(-lightDir, texNormal);\\n\\t\\t\\tvec3 viewDir = normalize(-vertPos);\\n\\n\\t\\t\\tfloat specAngle = max(dot(reflectDir, viewDir), 0.0);\\n\\t\\t\\tspec = pow(specAngle, 64.0) * texSpecular;\\n\\t\\t}\\n\\t\\tspecular += spec * lightColor;\\n\\t}\\n\\n\\tfloat shade = 0.0;\\n\\n\\tif (uMaterial.receivesShadows) {\\n\\t\\tfloat edge = 1.0/1024.0;\\n\\t\\tvec3 shadowPos = (vPositionInLight.xyz / vPositionInLight.w) * 0.5 + 0.5;\\n\\n\\t\\tfloat shadows[9];\\n\\n\\t\\tshadows[0] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y)).r;\\n\\t\\tshadows[1] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y)).r;\\n\\t\\tshadows[2] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y)).r;\\n\\t\\tshadows[3] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y - edge)).r;\\n\\t\\tshadows[4] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y + edge)).r;\\n\\t\\tshadows[5] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y - edge)).r;\\n\\t\\tshadows[6] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y - edge)).r;\\n\\t\\tshadows[7] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y + edge)).r;\\n\\t\\tshadows[8] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y + edge)).r;\\n\\n\\t\\tfloat distanceFromLight = shadowPos.z;\\n\\n\\t\\tfloat bias = 0.00001;\\n\\t\\tfor (int i = 0; i < 9; i++) {\\n\\t\\t\\tif (distanceFromLight > shadows[i] + bias) {\\n\\t\\t\\t\\tshade += 0.08;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\tvec3 shadowColor = vec3(0.0);\\n\\n\\tvec3 color = mix(texColor.rgb, shadowColor, shade);\\n\\tcolor = (ambient + diffuse + specular) * color;\\n\\tgl_FragColor = vec4(color, texColor.a);\\n}\\n\";","export default \"#define GLSLIFY 1\\nuniform mat4 uViewProj;\\nuniform mat4 uView;\\nuniform mat4 uModel;\\nuniform mat4 uLight;\\n\\nattribute vec3 position;\\nattribute vec3 normal;\\nattribute vec2 uv;\\n\\nvarying vec3 vNormal;\\nvarying vec3 vViewNormal;\\nvarying vec4 vPosition;\\nvarying vec3 vBasePosition;\\nvarying vec2 vTexCoord;\\nvarying vec4 vPositionInLight;\\n\\nvoid main(void) {\\n\\tmat4 mvp = uModel  * uViewProj;\\n\\tgl_Position = vec4(position, 1.0) * mvp;\\n\\tvBasePosition = position;\\n\\tvPosition = vec4(position, 1.0) * uModel;\\n\\t//vNormal = normalize((vec4(normal, 0.0) * uModel)).xyz;\\n\\tvNormal = normal;\\n\\tvViewNormal = normalize((vec4(normal, 0.0) * uModel * uView)).xyz;\\n\\tvPositionInLight = vec4(position, 1.0) * uModel * uLight;\\n\\tvTexCoord = uv;\\n}\\n\";","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nstruct Material {\\n\\tbool castsShadows;\\n\\tbool receivesShadows;\\n\\tbool hasTexture;\\n\\tbool hasNormalMap;\\n\\tbool hasSpecularMap;\\n\\tbool hasDisplacementMap;\\n\\tbool emissive;\\n\\tvec4 color;\\n\\tfloat displacementMultiplier;\\n\\tsampler2D texture;\\n\\tsampler2D normalMap;\\n\\tsampler2D specularMap;\\n\\tsampler2D displacementMap;\\n};\\n\\nstruct Light {\\n\\tvec3 position;\\n\\tvec3 ambient;\\n\\tvec3 diffuse;\\n\\tvec3 specular;\\n\\n\\tfloat constant;\\n\\tfloat linear;\\n\\tfloat quadratic;\\n};\\n\\nuniform mat4 uModel;\\nuniform vec4 uFillColor;\\nuniform mat4 uView;\\nuniform sampler2D uShadowMap;\\nuniform vec3 uLightDir;\\nuniform Material uMaterial;\\nuniform int uLightCount;\\nuniform Light uLights[32];\\n\\nvarying vec3 vNormal;\\nvarying vec3 vViewNormal;\\nvarying vec4 vPosition;\\nvarying vec2 vTexCoord;\\nvarying vec4 vPositionInLight;\\nvarying vec3 vBasePosition;\\n\\n#define PI 3.1415926535897932384626433832795\\n\\nvec2 toLonLat(vec3 point) {\\n\\tvec3 v = normalize(point);\\n\\tfloat lat = acos(v.y) - PI / 2.0;\\n\\tfloat lon = atan(v.z, v.x) + PI / 2.0;\\n\\treturn vec2(lon, lat);\\n}\\n\\nvec2 lonLatToUV(vec2 ll) {\\n\\tfloat x = -ll.x / PI / 2.0;\\n\\tfloat y = ll.y / PI + 0.5;\\n\\treturn vec2(fract(x), fract(y));\\n}\\n\\nvoid main(void) {\\n\\tvec2 uv = lonLatToUV(toLonLat(vBasePosition));\\n\\n\\tvec4 texColor;\\n\\tif (uMaterial.hasTexture) {\\n\\t\\ttexColor = texture2D(uMaterial.texture, uv);\\n\\t} else {\\n\\t\\ttexColor = uMaterial.color;\\n\\t}\\n\\n\\tvec3 texNormal;\\n\\tif (uMaterial.hasNormalMap) {\\n\\t\\ttexNormal = normalize(vec4(normalize(vNormal) * texture2D(uMaterial.normalMap, uv).rgb, 0.0) * uModel * uView).xyz;\\n\\t}\\n\\telse {\\n\\t\\ttexNormal = normalize(vec4(normalize(vNormal), 0.0) * uModel * uView).xyz;\\n\\t}\\n\\n\\tfloat texSpecular = 0.0;\\n\\tif (uMaterial.hasSpecularMap) {\\n\\t\\ttexSpecular = texture2D(uMaterial.specularMap, uv).r;\\n\\t}\\n\\n\\tif (uMaterial.emissive) {\\n\\t\\tgl_FragColor = texColor;\\n\\t\\treturn;\\n\\t}\\n\\n\\tvec4 vertPos4 = vPosition * uView;\\n\\tvec3 vertPos = vertPos4.xyz / vertPos4.w;\\n\\n\\tvec3 ambient = vec3(0.0);\\n\\tvec3 diffuse = vec3(0.0);\\n\\tvec3 specular = vec3(0.0);\\n\\n\\tfor (int i = 0; i < 32; i++) {\\n\\t\\tif (i >= uLightCount) break;\\n\\n\\t\\tvec4 lightPos4 = vec4(uLights[i].position, 1.0) * uView;\\n\\t\\tvec3 lightPos = lightPos4.xyz / lightPos4.w;\\n\\n\\t\\tvec3 lightDir = normalize(lightPos - vertPos);\\n\\t\\tvec3 lightColor = uLights[i].diffuse;\\n\\t\\tambient += uLights[i].ambient;\\n\\n\\t\\tfloat diff = max(dot(texNormal, lightDir), 0.0);\\n\\t\\tdiffuse += diff * lightColor;\\n\\n\\t\\tfloat lambertian = max(dot(texNormal, lightDir), 0.0);\\n\\t\\tfloat spec = 0.0;\\n\\n\\t\\tif (lambertian > 0.0) {\\n\\t\\t\\tvec3 reflectDir = reflect(-lightDir, texNormal);\\n\\t\\t\\tvec3 viewDir = normalize(-vertPos);\\n\\n\\t\\t\\tfloat specAngle = max(dot(reflectDir, viewDir), 0.0);\\n\\t\\t\\tspec = pow(specAngle, 64.0) * texSpecular;\\n\\t\\t}\\n\\t\\tspecular += spec * lightColor;\\n\\t}\\n\\n\\tfloat shade = 0.0;\\n\\n\\tif (uMaterial.receivesShadows) {\\n\\t\\tfloat edge = 1.0/1024.0;\\n\\t\\tvec3 shadowPos = (vPositionInLight.xyz / vPositionInLight.w) * 0.5 + 0.5;\\n\\n\\t\\tfloat shadows[9];\\n\\n\\t\\tshadows[0] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y)).r;\\n\\t\\tshadows[1] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y)).r;\\n\\t\\tshadows[2] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y)).r;\\n\\t\\tshadows[3] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y - edge)).r;\\n\\t\\tshadows[4] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y + edge)).r;\\n\\t\\tshadows[5] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y - edge)).r;\\n\\t\\tshadows[6] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y - edge)).r;\\n\\t\\tshadows[7] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y + edge)).r;\\n\\t\\tshadows[8] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y + edge)).r;\\n\\n\\t\\tfloat distanceFromLight = shadowPos.z;\\n\\n\\t\\tfloat bias = 0.00001;\\n\\t\\tfor (int i = 0; i < 9; i++) {\\n\\t\\t\\tif (distanceFromLight > shadows[i] + bias) {\\n\\t\\t\\t\\tshade += 0.08;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\tvec3 shadowColor = vec3(0.0);\\n\\n\\tvec3 color = mix(texColor.rgb, shadowColor, shade);\\n\\tcolor = (ambient + diffuse + specular) * color;\\n\\tgl_FragColor = vec4(color, texColor.a);\\n}\\n\";","export default \"#define GLSLIFY 1\\nstruct Material {\\n\\tbool castsShadows;\\n\\tbool receivesShadows;\\n\\tbool hasTexture;\\n\\tbool hasNormalMap;\\n\\tbool hasSpecularMap;\\n\\tbool hasDisplacementMap;\\n\\tbool emissive;\\n\\tvec4 color;\\n\\tfloat displacementMultiplier;\\n\\tsampler2D texture;\\n\\tsampler2D normalMap;\\n\\tsampler2D specularMap;\\n\\tsampler2D displacementMap;\\n};\\n\\n#define PI 3.1415926535897932384626433832795\\n\\nuniform mat4 uViewProj;\\nuniform mat4 uView;\\nuniform mat4 uModel;\\nuniform mat4 uLight;\\nuniform Material uMaterial;\\n\\nattribute vec3 position;\\nattribute vec3 normal;\\nattribute vec2 uv;\\n\\nvarying vec3 vNormal;\\nvarying vec3 vViewNormal;\\nvarying vec4 vPosition;\\nvarying vec3 vBasePosition;\\nvarying vec2 vTexCoord;\\nvarying vec4 vPositionInLight;\\n\\nvec2 toLonLat(vec3 point) {\\n\\tvec3 v = normalize(point);\\n\\tfloat lat = acos(v.y) - PI / 2.0;\\n\\tfloat lon = atan(v.z, v.x) + PI / 2.0;\\n\\treturn vec2(lon, lat);\\n}\\n\\nvec2 lonLatToUV(vec2 ll) {\\n\\tfloat x = -ll.x / PI / 2.0;\\n\\tfloat y = ll.y / PI + 0.5;\\n\\treturn vec2(fract(x), fract(y));\\n}\\n\\nvoid main(void) {\\n\\tmat4 mvp = uModel  * uViewProj;\\n\\tvec2 uv = lonLatToUV(toLonLat(position));\\n\\tvec3 pos = position;\\n\\tif (uMaterial.hasDisplacementMap) {\\n\\t\\tvec3 texNormal = texture2D(uMaterial.displacementMap, uv).rgb;\\n\\t\\tpos += normal * texNormal * uMaterial.displacementMultiplier;\\n\\t}\\n\\tgl_Position = vec4(pos, 1.0) * mvp;\\n\\tvBasePosition = pos;\\n\\tvPosition = vec4(pos, 1.0) * uModel;\\n\\t//vNormal = normalize((vec4(normal, 0.0) * uModel)).xyz;\\n\\tvNormal = normal;\\n\\tvViewNormal = normalize((vec4(normal, 0.0) * uModel * uView)).xyz;\\n\\tvPositionInLight = vec4(pos, 1.0) * uModel * uLight;\\n\\tvTexCoord = uv;\\n}\\n\";","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nuniform float uTime;\\nuniform vec4 uFillColor;\\nuniform sampler2D uShadowMap;\\nuniform vec3 uLightDir;\\n\\nvarying vec4 vColor;\\nvarying vec3 vNormal;\\nvarying vec3 vPosition;\\nvarying vec4 vPositionInLight;\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n\\tvec3 lightColor = vec3(1.0);\\n\\tvec3 ambient = 0.1 * lightColor;\\n\\n\\tfloat diff = max(dot(vNormal, uLightDir), 0.0);\\n\\tvec3 diffuse = diff * lightColor;\\n\\n\\tvec3 viewDir = normalize(-vPosition);\\n\\tvec3 reflectDir = reflect(-uLightDir, vNormal);\\n\\tfloat spec = pow(max(dot(viewDir, reflectDir), 0.0), 128.0);\\n\\tvec3 specular = 0.5 * spec * lightColor;\\n\\n\\tvec3 color = (ambient + diffuse + specular) * vColor.rgb;\\n\\n\\tif (uFillColor.a > 0.0) {\\n\\t\\tfloat shade = 0.0;\\n\\n\\t\\tfloat edge = 1.0/1024.0;\\n\\t\\tvec3 shadowPos = (vPositionInLight.xyz / vPositionInLight.w) * 0.5 + 0.5;\\n\\n\\t\\tfloat shadows[9];\\n\\n\\t\\tshadows[0] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y)).r;\\n\\t\\tshadows[1] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y)).r;\\n\\t\\tshadows[2] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y)).r;\\n\\t\\tshadows[3] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y - edge)).r;\\n\\t\\tshadows[4] = texture2D(uShadowMap, vec2(shadowPos.x, shadowPos.y + edge)).r;\\n\\t\\tshadows[5] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y - edge)).r;\\n\\t\\tshadows[6] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y - edge)).r;\\n\\t\\tshadows[7] = texture2D(uShadowMap, vec2(shadowPos.x - edge, shadowPos.y + edge)).r;\\n\\t\\tshadows[8] = texture2D(uShadowMap, vec2(shadowPos.x + edge, shadowPos.y + edge)).r;\\n\\n\\t\\tfloat distanceFromLight = shadowPos.z;\\n\\n\\t\\tfloat bias = 0.0001;\\n\\t\\tfor (int i = 0; i < 9; i++) {\\n\\t\\t\\tif (distanceFromLight > shadows[i] + bias) {\\n\\t\\t\\t\\tshade += 0.08;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tvec3 shadowColor = vec3(0.0);\\n\\t\\tgl_FragColor = vec4(mix(uFillColor.rgb, shadowColor, shade), vColor.a);\\n\\t} else {\\n\\t\\tgl_FragColor = vec4(color, vColor.a);\\n\\t}\\n}\\n\";","export default \"#define GLSLIFY 1\\nuniform mat4 uViewProj;\\nuniform mat4 uView;\\nuniform mat4 uModel;\\nuniform mat4 uLight;\\n\\nattribute vec3 position;\\nattribute vec3 normal;\\nattribute vec4 color;\\nattribute vec2 uv;\\n\\nvarying vec4 vColor;\\nvarying vec3 vNormal;\\nvarying vec3 vPosition;\\nvarying vec4 vPositionInLight;\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n\\tmat4 mvp = uModel  * uViewProj;\\n\\tgl_Position = vec4(position, 1.0) * mvp;\\n\\tvColor = color;\\n\\tvPosition = (vec4(position, 1.0) * uModel * uView).xyz;\\n\\tvPositionInLight = vec4(position, 1.0) * uModel * uLight;\\n\\tvNormal = normalize((vec4(normal, 0.0) * uModel)).xyz;\\n\\tvTexCoord = uv;\\n}\\n\";","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nuniform float uTime;\\nuniform sampler2D uSampler;\\nuniform float uContrast;\\n\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n\\tfloat contrast = uContrast > 0.0 ? uContrast : 1.0;\\n\\tgl_FragColor = (texture2D(uSampler, vTexCoord) - (1.0 - (1.0 / contrast))) * contrast;\\n}\\n\";","export default \"#define GLSLIFY 1\\nuniform mat4 uViewProj;\\nuniform mat4 uModel;\\n\\nattribute vec3 position;\\nattribute vec2 uv;\\n\\nvarying vec2 vTexCoord;\\n\\nvoid main(void) {\\n\\tmat4 mvp = uModel * uViewProj;\\n\\tgl_Position = vec4(position, 1.0) * mvp;\\n\\tvTexCoord = vec2(uv.x, 1.0 - uv.y);\\n}\\n\\n\";","export default \"precision mediump float;\\n\\nvarying vec4 vFogColor;\\nvarying float vFogDepth;\\nvarying vec3 vBarycentric;\\nvarying float vLineWidth;\\nvarying vec4 vColor;\\n\\n#extension GL_OES_standard_derivatives : enable\\n#define GLSLIFY 1\\n\\nfloat edgeDistance(vec3 barycentric) {\\n\\tvec3 d = fwidth(barycentric);\\n\\tvec3 a = smoothstep(vec3(0.0), d * 2.0, barycentric);\\n\\treturn min(min(a.x, a.y), a.z);\\n}\\n\\nvoid main(void) {\\n\\tvec4 lineColor = vColor;\\n\\tvec4 faceColor = vec4(0.0, 0.0, 0.0, vColor.a);\\n\\tvec4 color;\\n\\tfloat d = edgeDistance(vBarycentric);\\n\\tif (d < 1.0) {\\n\\t\\tcolor = mix(lineColor, faceColor, d);\\n\\t}\\n\\telse {\\n\\t\\tcolor = faceColor;\\n\\t}\\n\\n\\tgl_FragColor = mix(color, vFogColor, vFogDepth);\\n}\\n\";","export default \"#define GLSLIFY 1\\nuniform mat4 uViewProj;\\nuniform mat4 uModel;\\nuniform vec4 uFogColor;\\nuniform float uLineWidth;\\n\\nattribute vec3 position;\\nattribute vec3 barycentric;\\nattribute vec4 color;\\n\\nvarying vec4 vFogColor;\\nvarying float vFogDepth;\\nvarying vec3 vBarycentric;\\nvarying float vLineWidth;\\nvarying vec4 vColor;\\n\\nfloat fog_dist = 1000.0;\\n\\nvoid main(void) {\\n\\tmat4 mvp = uModel * uViewProj;\\n\\n\\tgl_Position = vec4(position, 1.0) * mvp;\\n\\tvFogDepth = max(0.0, min(1.0, gl_Position.z / fog_dist));\\n\\tvFogColor = uFogColor;\\n\\tvLineWidth = uLineWidth;\\n\\n\\tvColor = color;\\n\\tvBarycentric = barycentric;\\n}\\n\";","import { Matrix4, Point3, Vector3 } from './geom';\nimport { Mesh, Vertex } from './mesh';\nimport { Material, Color } from './material';\nimport { Shader, UniformValues } from './shader';\nimport { Component } from './component';\nimport { StaticMesh } from './components/static_mesh';\n\nexport interface Instance {\n\t[key: string]: number | number[] | Matrix4;\n}\n\nexport type ActorInstance<I extends Instance = Instance> = {\n\tpawn: Actor;\n\tdata: I;\n}\n\nexport interface ActorOptions {\n\tcolor?: Color;\n\tmaterial?: Material;\n\tmodel?: Matrix4;\n\tshader?: Shader;\n\tuniforms?: UniformValues;\n\tcomponents?: Component[];\n}\n\nexport class Actor<I extends Instance = Instance> {\n\tvisible: boolean = true;\n\tcomponents: Component[] = [];\n\tmodel: Matrix4 = Matrix4.identity();\n\tmaterial: Material;\n\tshader?: Shader;\n\tuniforms: UniformValues = {};\n\tchildren: Actor[] = [];\n\tinstances: Map<number, ActorInstance> = new Map();\n\tprivate nextInstanceId = 1;\n\n\tconstructor(meshOrOptions?: Mesh<Vertex> | Actor[] | ActorOptions, options: ActorOptions = {}) {\n\t\tif (meshOrOptions instanceof Array) {\n\t\t\tthis.children = meshOrOptions;\n\t\t} else if (meshOrOptions instanceof Mesh) {\n\t\t\tthis.components.push(new StaticMesh(meshOrOptions));\n\t\t}\n\t\telse if (typeof meshOrOptions === 'object') {\n\t\t\toptions = meshOrOptions;\n\t\t}\n\n\t\tconst material = options.material || new Material();\n\t\tmaterial.color = options.color || material.color;\n\n\t\tthis.material = material;\n\n\n\t\tif (options.model) {\n\t\t\tthis.model = options.model;\n\t\t}\n\n\t\tif (options.shader) {\n\t\t\tthis.shader = options.shader;\n\t\t}\n\n\t\tif (options.uniforms) {\n\t\t\tthis.uniforms = {\n\t\t\t\t...this.uniforms,\n\t\t\t\t...options.uniforms,\n\t\t\t};\n\t\t}\n\n\t\tif (options.components) {\n\t\t\tthis.components = [\n\t\t\t\t...this.components,\n\t\t\t\t...options.components,\n\t\t\t];\n\t\t}\n\t}\n\n\tinstance(data: I): number {\n\t\tconst id = this.nextInstanceId++;\n\n\t\tconst instance = {\n\t\t\tid,\n\t\t\tpawn: this,\n\t\t\tdata: { ...data },\n\t\t};\n\t\tthis.instances.set(id, instance);\n\n\t\treturn id;\n\t}\n\n\tget hasInstances(): boolean {\n\t\treturn this.instances.size !== 0;\n\t}\n\n\tget translationMatrix(): Matrix4 {\n\t\treturn this.model.extractTranslation();\n\t}\n\n\tget rotationMatrix(): Matrix4 {\n\t\treturn this.model.extractRotation();\n\t}\n\n\tget position(): Point3 {\n\t\treturn this.model.transformPoint3([0.0, 0.0, 0.0]);\n\t}\n\n\tset position(pos: Point3) {\n\t\tconst mat = this.model.toArray();\n\t\tmat[3] = pos[0];\n\t\tmat[7] = pos[1];\n\t\tmat[11] = pos[2];\n\t\tthis.model = new Matrix4(mat);\n\t}\n\n\tget rotationVector(): Vector3 {\n\t\tconst vec = this.model.multiplyVector4([0.0, 0.0, 1.0, 0.0]);\n\t\treturn [vec[0], vec[1], vec[2]];\n\t}\n\n\tgetComponentsOfType<C extends Component>(klass: Constructable<C>): C[] {\n\t\treturn this.components.filter(c => c instanceof klass) as C[];\n\t}\n\n\thasComponentOfType<C extends Component>(klass: Constructable<C>): boolean {\n\t\treturn Boolean(this.components.find(c => c instanceof klass));\n\t}\n}\n","import { Matrix4, Point3, Vector3 } from './geom';\nimport { Actor } from './actor';\n\nexport interface Camera {\n\twidth: number;\n\theight: number;\n\tview: Matrix4;\n\tprojection: Matrix4;\n\tresize(width: number, height: number): void;\n}\n\nexport class OrbitCamera extends Actor implements Camera {\n\twidth: number;\n\theight: number;\n\tnear: number = 0.1;\n\tfar: number = 1000.0;\n\tprojection: Matrix4;\n\tdistance: number = 10.0;\n\ttarget: Point3 = [0.0, 0.0, 0.0];\n\trotation = { lon: 0.0, lat: 0.0 };\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.resize(1024, 768);\n\t}\n\n\tget view(): Matrix4 {\n\t\tconst pos = this.target;\n\t\treturn Matrix4.identity()\n\t\t\t.multiply(Matrix4.translation(pos[0], pos[1], pos[2]))\n\t\t\t.multiply(Matrix4.rotation(0.0, this.rotation.lon, 0.0))\n\t\t\t.multiply(Matrix4.rotation(this.rotation.lat, 0.0, 0.0))\n\t\t\t.multiply(Matrix4.translation(0.0, 0.0, this.distance));\n\t}\n\n\tresize(width: number, height: number): void {\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.projection = Matrix4.perspective(width / height, 45.0, this.near, this.far);\n\t}\n\n\tzoom(amount: number) {\n\t\tthis.distance += amount;\n\t}\n\n\trotate(lon: number, lat: number) {\n\t\tthis.rotation = {\n\t\t\tlon: this.rotation.lon + lon,\n\t\t\tlat: this.rotation.lat + lat,\n\t\t};\n\t\tif (this.rotation.lat < -Math.PI / 2) {\n\t\t\tthis.rotation.lat = -Math.PI / 2;\n\t\t}\n\t\tif (this.rotation.lat > Math.PI / 2) {\n\t\t\tthis.rotation.lat = Math.PI / 2;\n\t\t}\n\t}\n}\n\nexport class BasicCamera extends Actor implements Camera {\n\twidth: number;\n\theight: number;\n\tnear: number = 1.0;\n\tfar: number = 2000.0;\n\tprojection: Matrix4;\n\tposition: Point3 = [0.0, 1.0, 0.0];\n\trotation: Vector3 = [0.0, 0.0, 0.0];\n\tscaling: Vector3 = [1.0, 1.0, 1.0];\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.resize(1024, 768);\n\t}\n\n\tget view(): Matrix4 {\n\t\treturn Matrix4.identity()\n\t\t\t.multiply(Matrix4.translation(...this.position))\n\t\t\t.multiply(this.rotationMatrix)\n\t\t\t.multiply(Matrix4.scaling(...this.scaling));\n\t}\n\n\tget rotationMatrix(): Matrix4 {\n\t\treturn Matrix4.identity()\n\t\t\t.multiply(Matrix4.rotation(0, 0, this.rotation[2]))\n\t\t\t.multiply(Matrix4.rotation(0, this.rotation[1], 0))\n\t\t\t.multiply(Matrix4.rotation(this.rotation[0], 0, 0));\n\t}\n\tupdateModel() {\n\t\tthis.model = this.view;\n\t}\n\n\trotate(x: number, y: number) {\n\t\tthis.rotation[0] -= Math.PI * x;\n\t\tthis.rotation[1] -= Math.PI * y;\n\n\t\tif (this.rotation[0] < -Math.PI / 2 + 0.01) {\n\t\t\tthis.rotation[0] = -Math.PI / 2 + 0.01;\n\t\t}\n\t\tif (this.rotation[0] > Math.PI / 2 - 0.01) {\n\t\t\tthis.rotation[0] = Math.PI / 2 - 0.01;\n\t\t}\n\n\t\tthis.updateModel();\n\t}\n\n\ttranslate(x: number, y: number, z: number) {\n\t\tconst trans = Matrix4.translation(x, y, z);\n\t\tconst rotation = this.rotationVector;\n\n\t\t// Ignore tilt\n\t\tconst oldX = rotation[0];\n\t\trotation[0] = 0.0;\n\t\tconst rot = this.rotationMatrix;\n\t\trotation[0] = oldX;\n\t\tconst invRot = rot.inverse();\n\n\t\tlet newPosition = trans.multiply(invRot).transformPoint3(this.position);\n\t\tnewPosition = rot.transformPoint3(newPosition);\n\t\tthis.position = newPosition;\n\t\tthis.updateModel();\n\t}\n\n\tresize(width: number, height: number) {\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.projection = Matrix4.perspective(width / height, 45.0, this.near, this.far);\n\t\tthis.updateModel();\n\t}\n}\n","export class Component {\n}\n","import { Component } from '../component';\nimport { Color } from '../material';\n\nexport interface LightOptions {\n\tambient?: Color;\n\tdiffuse?: Color;\n\tspecular?: Color;\n\n\tconstant?: number;\n\tlinear?: number;\n\tquadratic?: number;\n}\n\nexport class Light extends Component {\n\tambient: Color;\n\tdiffuse: Color;\n\tspecular: Color;\n\n\tconstant: number;\n\tlinear: number;\n\tquadratic: number;\n\n\tconstructor(options: LightOptions = {}) {\n\t\tsuper();\n\n\t\tif (options.ambient) {\n\t\t\tthis.ambient = options.ambient;\n\t\t}\n\t\tif (options.diffuse) {\n\t\t\tthis.diffuse = options.diffuse;\n\t\t}\n\t\tif (options.specular) {\n\t\t\tthis.specular = options.specular;\n\t\t}\n\t\tif (options.constant) {\n\t\t\tthis.constant = options.constant;\n\t\t}\n\t\tif (options.linear) {\n\t\t\tthis.linear = options.linear;\n\t\t}\n\t\tif (options.quadratic) {\n\t\t\tthis.quadratic = options.quadratic;\n\t\t}\n\t}\n}\n\n","import { Component } from '../component';\nimport { Mesh } from '../mesh';\n\nexport class StaticMesh extends Component {\n\tmesh: Mesh;\n\n\tconstructor(mesh: Mesh) {\n\t\tsuper();\n\t\tthis.mesh = mesh;\n\t}\n}\n","export type Point4 = [number, number, number, number];\nexport type Point3 = [number, number, number];\nexport type Point2 = [number, number];\nexport type Vector4 = [number, number, number, number];\nexport type Vector3 = [number, number, number];\nexport type Vector2 = [number, number];\nexport type Rect = [number, number, number, number];\nexport type LonLat = [number, number];\n\nexport type Columns = [Vector4, Vector4, Vector4, Vector4];\nexport type Rows = [Vector4, Vector4, Vector4, Vector4];\n\n// prettier-ignore\nexport class Matrix4 {\n\tprivate _data: Float32Array;\n\n\tconstructor(data?: number[] | Float32Array) {\n\t\tthis._data = new Float32Array(16);\n\t\tif (data) {\n\t\t\tfor (let i = 0; i < 16; i++) {\n\t\t\t\tthis._data[i] = data[i];\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic identity(): Matrix4 {\n\t\treturn new Matrix4([\n\t\t\t1, 0, 0, 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1,\n\t\t]);\n\t}\n\n\tstatic fromColumns(cols: Columns): Matrix4 {\n\t\treturn new Matrix4([\n\t\t\tcols[0][0], cols[1][0], cols[2][0], cols[3][0],\n\t\t\tcols[0][1], cols[1][1], cols[2][1], cols[3][1],\n\t\t\tcols[0][2], cols[1][2], cols[2][2], cols[3][2],\n\t\t\tcols[0][3], cols[1][3], cols[2][3], cols[3][3],\n\t\t]);\n\t}\n\n\tstatic perspective(aspect: number, fov: number, near: number, far: number): Matrix4 {\n\t\tconst fovRad = fov * (Math.PI / 180);\n\t\tconst f = 1.0 / Math.tan(fovRad / 2.0);\n\t\tconst range = 1.0 / (near - far);\n\t\treturn new Matrix4([\n\t\t\tf / aspect, 0,                    0,                      0,\n\t\t\t0,          f,                    0,                      0,\n\t\t\t0,          0, (near + far) * range, near * far * range * 2,\n\t\t\t0,          0,                   -1,                      0,\n\t\t]);\n\t}\n\n\tstatic rotation(x: number, y: number, z: number): Matrix4 {\n\t\tconst axisangle: Vector3 = [x, y, z];\n\n\t\tfunction cosSin(axis: number): [number, number] {\n\t\t\treturn [Math.cos(axisangle[axis]), Math.sin(axisangle[axis])];\n\t\t}\n\n\n\t\tconst [cosx, sinx] = cosSin(0);\n\t\tconst [cosy, siny] = cosSin(1);\n\t\tconst [cosz, sinz] = cosSin(2);\n\t\tconst rotx = new Matrix4([\n\t\t\t1,    0,     0, 0,\n\t\t\t0, cosx, -sinx, 0,\n\t\t\t0, sinx,  cosx, 0,\n\t\t\t0,    0,     0, 1,\n\t\t]);\n\t\tconst roty = new Matrix4([\n\t\t\tcosy,  0, siny, 0,\n\t\t\t   0,  1,    0, 0,\n\t\t\t-siny, 0, cosy, 0,\n\t\t\t    0, 0,    0, 1,\n\t\t]);\n\t\tconst rotz = new Matrix4([\n\t\t\tcosz, -sinz, 0, 0,\n\t\t\tsinz,  cosz, 0, 0,\n\t\t\t   0,     0, 1, 0,\n\t\t\t   0,     0, 0, 1,\n\t\t]);\n\n\t\treturn rotx.multiply(roty.multiply(rotz));\n\t}\n\n\tstatic translation(x: number, y: number, z: number): Matrix4 {\n\t\treturn new Matrix4([\n\t\t\t1, 0, 0, x,\n\t\t\t0, 1, 0, y,\n\t\t\t0, 0, 1, z,\n\t\t\t0, 0, 0, 1,\n\t\t]);\n\t}\n\n\tstatic scaling(x: number, y?: number, z?: number): Matrix4 {\n\t\tif (y == null) y = x;\n\t\tif (z == null) z = y;\n\n\t\treturn new Matrix4([\n\t\t\tx, 0, 0, 0,\n\t\t\t0, y, 0, 0,\n\t\t\t0, 0, z, 0,\n\t\t\t0, 0, 0, 1,\n\t\t]);\n\t}\n\n\tstatic lookAt(from: Point3, to: Point3) {\n\t\tconst forward = normalize([\n\t\t\tfrom[0] - to[0],\n\t\t\tfrom[1] - to[1],\n\t\t\tfrom[2] - to[2],\n\t\t]);\n\n\t\tconst right = cross([0.0, 1.0, 0.0], forward);\n\n\t\tconst up = cross(forward, right);\n\n\t\tconst view = new Matrix4([\n\t\t\tright[0], up[0], forward[0], from[0],\n\t\t\tright[1], up[1], forward[1], from[1],\n\t\t\tright[2], up[2], forward[2], from[2],\n\t\t         0,      0,         0,       1,\n\t\t]);\n\n\t\treturn view;\n\t}\n\n\tclone(): Matrix4 {\n\t\treturn new Matrix4(this._data);\n\t}\n\n\ttoArray(): number[] {\n\t\treturn Array.from(this._data);\n\t}\n\n\tat(col: number, row: number): number {\n\t\tconst idx = row * 4 + col;\n\t\treturn this._data[idx];\n\t}\n\n\tcolumn(axis: number): Vector4 {\n\t\tconst d = this._data;\n\t\treturn [\n\t\t\td[axis + 0],\n\t\t\td[axis + 4],\n\t\t\td[axis + 8],\n\t\t\td[axis + 12],\n\t\t];\n\t}\n\n\trow(axis: number): Vector4 {\n\t\tconst d = this._data;\n\t\tconst o = 4 * axis;\n\t\treturn [\n\t\t\td[o + 0],\n\t\t\td[o + 1],\n\t\t\td[o + 2],\n\t\t\td[o + 3],\n\t\t];\n\t}\n\n\tget columns(): Columns {\n\t\treturn [\n\t\t\tthis.column(0),\n\t\t\tthis.column(1),\n\t\t\tthis.column(2),\n\t\t\tthis.column(3),\n\t\t];\n\t}\n\n\tget rows(): Rows {\n\t\treturn [\n\t\t\tthis.row(0),\n\t\t\tthis.row(1),\n\t\t\tthis.row(2),\n\t\t\tthis.row(3),\n\t\t];\n\t}\n\n\tmultiply(other: Matrix4): Matrix4 {\n\t\tconst [colx, coly, colz, colw] = other.columns;\n\t\tconst columns: Columns = [\n\t\t\tthis.multiplyVector4(colx),\n\t\t\tthis.multiplyVector4(coly),\n\t\t\tthis.multiplyVector4(colz),\n\t\t\tthis.multiplyVector4(colw),\n\t\t];\n\t\treturn Matrix4.fromColumns(columns);\n\t}\n\n\tmultiplyVector4(vec: Vector4): Vector4 {\n\t\tconst cols = this.columns;\n\n\t\tconst x = scaleVector4(cols[0], vec[0]);\n\t\tconst y = scaleVector4(cols[1], vec[1]);\n\t\tconst z = scaleVector4(cols[2], vec[2]);\n\t\tconst w = scaleVector4(cols[3], vec[3]);\n\t\treturn [\n\t\t\t(x[0] + y[0] + z[0] + w[0]),\n\t\t\t(x[1] + y[1] + z[1] + w[1]),\n\t\t\t(x[2] + y[2] + z[2] + w[2]),\n\t\t\t(x[3] + y[3] + z[3] + w[3]),\n\t\t];\n\t}\n\n\ttransformPoint3(point: Point3): Point3 {\n\t\tconst vec = this.multiplyVector4([point[0], point[1], point[2], 1]);\n\n\t\treturn [\n\t\t\tvec[0] / vec[3],\n\t\t\tvec[1] / vec[3],\n\t\t\tvec[2] / vec[3],\n\t\t];\n\t}\n\n\tinverse(): Matrix4 {\n\t\tconst inv = new Array(16);\n\t\tconst m = this.toArray();\n\n\t\tinv[0] = m[5]*m[10]*m[15] -\n\t\t\tm[5]*m[14]*m[11] -\n\t\t\tm[6]*m[9]*m[15] +\n\t\t\tm[6]*m[13]*m[11] +\n\t\t\tm[7]*m[9]*m[14] -\n\t\t\tm[7]*m[13]*m[10];\n\n\t\tinv[1] = -m[1]*m[10]*m[15] +\n\t\t\tm[1]*m[14]*m[11] +\n\t\t\tm[2]*m[9]*m[15] -\n\t\t\tm[2]*m[13]*m[11] -\n\t\t\tm[3]*m[9]*m[14] +\n\t\t\tm[3]*m[13]*m[10];\n\n\t\tinv[2] = m[1]*m[6]*m[15] -\n\t\t\tm[1]*m[14]*m[7] -\n\t\t\tm[2]*m[5]*m[15] +\n\t\t\tm[2]*m[13]*m[7] +\n\t\t\tm[3]*m[5]*m[14] -\n\t\t\tm[3]*m[13]*m[6];\n\n\t\tinv[3] = -m[1]*m[6]*m[11] +\n\t\t\tm[1]*m[10]*m[7] +\n\t\t\tm[2]*m[5]*m[11] -\n\t\t\tm[2]*m[9]*m[7] -\n\t\t\tm[3]*m[5]*m[10] +\n\t\t\tm[3]*m[9]*m[6];\n\n\t\tinv[4] = -m[4]*m[10]*m[15] +\n\t\t\tm[4]*m[14]*m[11] +\n\t\t\tm[6]*m[8]*m[15] -\n\t\t\tm[6]*m[12]*m[11] -\n\t\t\tm[7]*m[8]*m[14] +\n\t\t\tm[7]*m[12]*m[10];\n\n\t\tinv[5] = m[0]*m[10]*m[15] -\n\t\t\tm[0]*m[14]*m[11] -\n\t\t\tm[2]*m[8]*m[15] +\n\t\t\tm[2]*m[12]*m[11] +\n\t\t\tm[3]*m[8]*m[14] -\n\t\t\tm[3]*m[12]*m[10];\n\n\t\tinv[6] = -m[0]*m[6]*m[15] +\n\t\t\tm[0]*m[14]*m[7] +\n\t\t\tm[2]*m[4]*m[15] -\n\t\t\tm[2]*m[12]*m[7] -\n\t\t\tm[3]*m[4]*m[14] +\n\t\t\tm[3]*m[12]*m[6];\n\n\t\tinv[7] = m[0]*m[6]*m[11] -\n\t\t\tm[0]*m[10]*m[7] -\n\t\t\tm[2]*m[4]*m[11] +\n\t\t\tm[2]*m[8]*m[7] +\n\t\t\tm[3]*m[4]*m[10] -\n\t\t\tm[3]*m[8]*m[6];\n\n\t\tinv[8] = m[4]*m[9]*m[15] -\n\t\t\tm[4]*m[13]*m[11] -\n\t\t\tm[5]*m[8]*m[15] +\n\t\t\tm[5]*m[12]*m[11] +\n\t\t\tm[7]*m[8]*m[13] -\n\t\t\tm[7]*m[12]*m[9];\n\n\t\tinv[9] = -m[0]*m[9]*m[15] +\n\t\t\tm[0]*m[13]*m[11] +\n\t\t\tm[1]*m[8]*m[15] -\n\t\t\tm[1]*m[12]*m[11] -\n\t\t\tm[3]*m[8]*m[13] +\n\t\t\tm[3]*m[12]*m[9];\n\n\t\tinv[10] = m[0]*m[5]*m[15] -\n\t\t\tm[0]*m[13]*m[7] -\n\t\t\tm[1]*m[4]*m[15] +\n\t\t\tm[1]*m[12]*m[7] +\n\t\t\tm[3]*m[4]*m[13] -\n\t\t\tm[3]*m[12]*m[5];\n\n\t\tinv[11] = -m[0]*m[5]*m[11] +\n\t\t\tm[0]*m[9]*m[7] +\n\t\t\tm[1]*m[4]*m[11] -\n\t\t\tm[1]*m[8]*m[7] -\n\t\t\tm[3]*m[4]*m[9] +\n\t\t\tm[3]*m[8]*m[5];\n\n\t\tinv[12] = -m[4]*m[9]*m[14] +\n\t\t\tm[4]*m[13]*m[10] +\n\t\t\tm[5]*m[8]*m[14] -\n\t\t\tm[5]*m[12]*m[10] -\n\t\t\tm[6]*m[8]*m[13] +\n\t\t\tm[6]*m[12]*m[9];\n\n\t\tinv[13] = m[0]*m[9]*m[14] -\n\t\t\tm[0]*m[13]*m[10] -\n\t\t\tm[1]*m[8]*m[14] +\n\t\t\tm[1]*m[12]*m[10] +\n\t\t\tm[2]*m[8]*m[13] -\n\t\t\tm[2]*m[12]*m[9];\n\n\t\tinv[14] = -m[0]*m[5]*m[14] +\n\t\t\tm[0]*m[13]*m[6] +\n\t\t\tm[1]*m[4]*m[14] -\n\t\t\tm[1]*m[12]*m[6] -\n\t\t\tm[2]*m[4]*m[13] +\n\t\t\tm[2]*m[12]*m[5];\n\n\t\tinv[15] = m[0]*m[5]*m[10] -\n\t\t\tm[0]*m[9]*m[6] -\n\t\t\tm[1]*m[4]*m[10] +\n\t\t\tm[1]*m[8]*m[6] +\n\t\t\tm[2]*m[4]*m[9] -\n\t\t\tm[2]*m[8]*m[5];\n\n\t\tconst det = m[0]*inv[0] + m[4]*inv[4] + m[8]*inv[8] + m[12]*inv[12];\n\t\tif (det == 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new Matrix4(inv);\n\t}\n\n\textractTranslation(): Matrix4 {\n\t\tconst x = this._data[3];\n\t\tconst y = this._data[7];\n\t\tconst z = this._data[11];\n\t\treturn Matrix4.translation(x, y, z);\n\t}\n\n\textractScaling(): Matrix4 {\n\t\tconst x = 0;\n\t\tconst y = 0;\n\t\tconst z = 0;\n\t\treturn Matrix4.scaling(x, y, z);\n\t}\n\n\textractRotation(): Matrix4 {\n\t\tconst x = 0;\n\t\tconst y = 0;\n\t\tconst z = 0;\n\t\treturn Matrix4.rotation(x, y, z);\n\t}\n\n\teulerAngles(): Vector3 {\n\t\tconst sy = Math.sqrt(this.at(0, 0) * this.at(0, 0) + this.at(1, 0) * this.at(1, 0));\n\t\tconst singular = sy < 1e-6;\n\n\t\tlet x = 0.0;\n\t\tlet y = 0.0;\n\t\tlet z = 0.0;\n\n\t\tif (singular) {\n\t\t\tx = Math.atan2(this.at(1, 2), this.at(1, 1));\n\t\t\ty = Math.atan2(this.at(2, 0), sy);\n\t\t\tz = 0;\n\t\t} else {\n\t\t\tx = Math.atan2(-this.at(2, 1), this.at(2, 2));\n\t\t\ty = Math.atan2(this.at(2, 0), sy);\n\t\t\tz = Math.atan2(-this.at(1, 0), this.at(0, 0));\n\t\t}\n\n\t\treturn [x, y, z];\n\t}\n}\n\nexport function scaleVector4(vec: Vector4, scale: number): Vector4 {\n\treturn [vec[0] * scale, vec[1] * scale, vec[2] * scale, vec[3] * scale];\n}\n\nexport function addVector4(vec: Vector4, other: Vector4): Vector4 {\n\treturn [vec[0] + other[0], vec[1] + other[1], vec[2] + other[2], vec[3] + other[3]];\n}\n\nexport function subtractVector4(vec: Vector4, other: Vector4): Vector4 {\n\treturn [vec[0] - other[0], vec[1] - other[1], vec[2] - other[2], vec[3] - other[3]];\n}\n\nexport function multiplyVector4(vec: Vector4, other: Vector4): Vector4 {\n\treturn [vec[0] * other[0], vec[1] * other[1], vec[2] * other[2], vec[3] * other[3]];\n}\n\nexport function scaleVector3(vec: Vector3, scale: number): Vector3 {\n\treturn [vec[0] * scale, vec[1] * scale, vec[2] * scale];\n}\n\nexport function addVector3(vec: Vector3, other: Vector3): Vector3 {\n\treturn [vec[0] + other[0], vec[1] + other[1], vec[2] + other[2]];\n}\n\nexport function subtractVector3(vec: Vector3, other: Vector3): Vector3 {\n\treturn [vec[0] - other[0], vec[1] - other[1], vec[2] - other[2]];\n}\n\nexport function multiplyVector3(vec: Vector3, other: Vector3): Vector3 {\n\treturn [vec[0] * other[0], vec[1] * other[1], vec[2] * other[2]];\n}\n\nexport function distanceVector3(vec: Vector3, other: Vector3): number {\n\tconst diff = subtractVector3(vec, other);\n\treturn Math.abs(magnitude(diff));\n}\n\nexport function cross(p0: Vector3, p1: Vector3): Vector3 {\n\tconst x = p0[1] * p1[2] - p0[2] * p1[1];\n\tconst y = p0[2] * p1[0] - p0[0] * p1[2];\n\tconst z = p0[0] * p1[1] - p0[1] * p1[0];\n\treturn [x, y, z];\n}\n\nexport function dot(p0: Vector3, p1: Vector3): number {\n\tconst x = p0[0] * p1[0];\n\tconst y = p0[1] * p1[1];\n\tconst z = p0[2] * p1[2];\n\treturn x + y + z;\n}\n\nexport function normalize(v: Vector3): Vector3 {\n\tconst norm = magnitude(v);\n\treturn [v[0] / norm, v[1] / norm, v[2] / norm];\n}\n\nexport function magnitude(v: Vector3): number {\n\treturn Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\n}\n\nexport function raySphereIntersection(center: Point3, radius: number, origin: Point3, direction: Vector3): Point3 | null {\n\tconst p: Vector3 = [\n\t\torigin[0] - center[0],\n\t\torigin[1] - center[1],\n\t\torigin[2] - center[2],\n\t];\n\n\tconst a = Math.pow(magnitude(direction), 2);\n\tconst b = dot(direction, p);\n\tconst c = Math.pow(magnitude(p), 2) - radius * radius;\n\tconst delta = b * b - a * c;\n\tif (delta < 0) {\n\t\treturn null;\n\t}\n\n\tconst deltaSqrt = Math.sqrt(delta);\n\n\tconst tmin = (-b - deltaSqrt) / a;\n\tconst tmax = (-b + deltaSqrt) / a;\n\n\tif (tmax < 0) {\n\t\treturn null;\n\t}\n\n\tconst t = tmin >= 0 ? tmin : tmax;\n\n\treturn [\n\t\torigin[0] + t * direction[0],\n\t\torigin[1] + t * direction[1],\n\t\torigin[2] + t * direction[2],\n\t];\n}\n\nexport function pointToLonLat(point: Point3): LonLat {\n\tconst v = normalize(point);\n\tconst p = normalize([v[0], 0, v[2]]);\n\tlet lat = Math.acos(dot(p, v));\n\tif (v[1] < 0) {\n\t\tlat *= -1;\n\t}\n\tlet lon = -Math.atan2(-v[2], -v[0]) - Math.PI / 2;\n\tif (lon < -Math.PI) {\n\t\tlon += Math.PI * 2;\n\t}\n\n\treturn [lon, lat];\n}\n\nexport function lonLatToPoint(ll: LonLat, radius: number = 1): Point3 {\n\tconst lon = ll[0] - Math.PI;\n\tconst lat = ll[1] - Math.PI / 2;\n\n\tconst x = radius * Math.sin(lat) * Math.sin(lon);\n\tconst y = radius * Math.cos(lat);\n\tconst z = radius * Math.sin(lat) * Math.cos(lon);\n\n\treturn [x, y, z];\n}\n","export * from './renderer';\nexport * from './renderer/webgl_renderer';\nexport * from './actor';\nexport * from './scene';\nexport * from './camera';\nexport * from './material';\nexport * from './geom';\nexport * from './texture';\nexport * from './shader';\nexport * from './mesh';\nexport * from './light';\nexport * from './component';\nexport * from './render_texture';\nexport * from './shaders/material';\nexport * from './shaders/sprite';\nexport * from './shaders/simple';\n\nexport * from './components/static_mesh';\nexport { Light as LightComponent } from './components/light';\n\nexport * from './meshes/obj';\nexport * from './meshes/cube';\nexport * from './meshes/sphere';\nexport { Quad } from './meshes/quad';\n","import { Color } from './material';\nimport { BasicCamera } from './camera';\n\nexport class Light extends BasicCamera {\n\tcolor: Color = [1.0, 1.0, 1.0, 1.0];\n\tcastsShadows = false;\n}\n","import { Texture } from './texture';\n\nexport type Color = [number, number, number, number?];\n\nexport interface MaterialOptions {\n\tcolor?: Color;\n\ttexture?: Texture;\n\tnormalMap?: Texture;\n\tspecularMap?: Texture;\n\tdisplacementMap?: Texture;\n\tdisplacementMultiplier?: number;\n\treceivesShadows?: boolean;\n\tcastsShadows?: boolean;\n\temissive?: boolean;\n\twireframe?: boolean;\n}\n\nexport class Material {\n\tcolor: Color = [1.0, 0.0, 0.0, 0.0];\n\ttexture?: Texture = null;\n\tnormalMap?: Texture = null;\n\tspecularMap?: Texture = null;\n\tdisplacementMap?: Texture = null;\n\tdisplacementMultiplier = 1.0;\n\treceivesShadows = true;\n\tcastsShadows = true;\n\temissive = false;\n\twireframe = false;\n\n\tconstructor(props?: MaterialOptions) {\n\t\tif (props?.color != null) {\n\t\t\tthis.color = props.color;\n\t\t}\n\t\tif (props?.texture != null) {\n\t\t\tthis.texture = props.texture;\n\t\t}\n\t\tif (props?.normalMap != null) {\n\t\t\tthis.normalMap = props.normalMap;\n\t\t}\n\t\tif (props?.specularMap != null) {\n\t\t\tthis.specularMap = props.specularMap;\n\t\t}\n\t\tif (props?.displacementMap != null) {\n\t\t\tthis.displacementMap = props.displacementMap;\n\t\t}\n\t\tif (props?.displacementMultiplier != null) {\n\t\t\tthis.displacementMultiplier = props.displacementMultiplier;\n\t\t}\n\t\tif (props?.receivesShadows != null) {\n\t\t\tthis.receivesShadows = props.receivesShadows;\n\t\t}\n\t\tif (props?.castsShadows != null) {\n\t\t\tthis.castsShadows = props.castsShadows;\n\t\t}\n\t\tif (props?.emissive != null) {\n\t\t\tthis.emissive = props.emissive;\n\t\t}\n\t\tif (props?.wireframe != null) {\n\t\t\tthis.wireframe = props.wireframe;\n\t\t}\n\t}\n}\n","import { Matrix4, Point3, Vector3, normalize, cross } from './geom';\nimport { Vertex } from './renderer/vertex';\nexport { Vertex };\n\nexport interface GeometryOptions {\n\ttransform?: Matrix4;\n}\n\nexport class Geometry<V extends Vertex> {\n\tvertices: V[] = [];\n\ttransform: Matrix4 = Matrix4.identity();\n\n\tconstructor(vertices?: V[], options?: GeometryOptions) {\n\t\tif (vertices) {\n\t\t\tthis.vertices = [...vertices];\n\t\t}\n\t\tif (options?.transform) {\n\t\t\tthis.transform = options.transform;\n\t\t}\n\t}\n\n\tclone(): Geometry<V> {\n\t\treturn new Geometry(\n\t\t\tthis.vertices.map((v) => ({ ...v })),\n\t\t\t{ transform: this.transform.clone() }\n\t\t);\n\t}\n\n\tcalculateNormals() {\n\t\tif (this.vertices.length === 0) return;\n\t\tconst vertices = this.vertices as any[] as { position: Point3, normal: Vector3 }[];\n\n\t\tif (!('normal' in vertices[0])) {\n\t\t\tthrow `Geometry Vertex doesn't have a 'normal' attribute`;\n\t\t}\n\n\t\tfor (let i = 0; i < this.vertices.length; i += 3) {\n\t\t\tconst p0 = vertices[i + 0].position;\n\t\t\tconst p1 = vertices[i + 1].position;\n\t\t\tconst p2 = vertices[i + 2].position;\n\n\t\t\tconst v0: Vector3 = [p1[0] - p0[0], p1[1] - p0[1], p1[2] - p0[2]];\n\t\t\tconst v1: Vector3 = [p2[0] - p0[0], p2[1] - p0[1], p2[2] - p0[2]];\n\t\t\tconst normal = normalize(cross(v0, v1));\n\t\t\tvertices[i + 0].normal = normal;\n\t\t\tvertices[i + 1].normal = normal;\n\t\t\tvertices[i + 2].normal = normal;\n\t\t}\n\t}\n}\n\nexport class Mesh<V extends Vertex = Vertex> {\n\tgeometries: Geometry<V>[] = [];\n\n\tconstructor(geom?: Geometry<V> | Geometry<V>[] | V[]) {\n\t\tif (geom) {\n\t\t\tif (Array.isArray(geom)) {\n\t\t\t\tif (geom.length === 0 || geom[0] instanceof Geometry) {\n\t\t\t\t\tthis.geometries = [...geom] as Geometry<V>[];\n\t\t\t\t} else {\n\t\t\t\t\tthis.geometries = [new Geometry(geom as V[])];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.geometries = [geom];\n\t\t\t}\n\t\t}\n\t}\n\n\tclone(): Mesh<V> {\n\t\treturn new Mesh(this.geometries.map((g) => g.clone()));\n\t}\n\n\tget vertexCount(): number {\n\t\tlet count = 0;\n\t\tfor (const geom of this.geometries) {\n\t\t\tcount += geom.vertices.length;\n\t\t}\n\t\treturn count;\n\t}\n\n\tget vertices(): V[] {\n\t\t// Preallocate the array as it's much faster than a bunch of `Array.concat`\n\t\tconst data: V[] = new Array(this.vertexCount);\n\n\t\tlet i = 0;\n\t\tfor (const geom of this.geometries) {\n\t\t\tfor (const vertex of geom.vertices) {\n\t\t\t\tdata[i] = {\n\t\t\t\t\t...vertex,\n\t\t\t\t\tposition: geom.transform.transformPoint3(vertex.position),\n\t\t\t\t};\n\t\t\t\ti++;\n\t\t\t}\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tcalculateNormals() {\n\t\tfor (const geom of this.geometries) {\n\t\t\tgeom.calculateNormals();\n\t\t}\n\t}\n}\n","import { Mesh } from '../mesh';\nimport { Point3, Point2, Vector3 } from '../geom';\nimport { Color } from '../material';\n\nexport type CubeVertex = {\n\tposition: Point3;\n\tuv: Point2;\n\tnormal: Vector3;\n\tcolor: Color;\n};\n\nexport class Cube extends Mesh<CubeVertex> {\n\tconstructor() {\n\t\tconst data: CubeVertex[] = new Array(FACE_VERTICES.length / 3);\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\t// prettier-ignore\n\t\t\tconst position: Point3 = [\n\t\t\t\tFACE_VERTICES[i * 3 + 0],\n\t\t\t\tFACE_VERTICES[i * 3 + 1],\n\t\t\t\tFACE_VERTICES[i * 3 + 2],\n\t\t\t];\n\t\t\t// prettier-ignore\n\t\t\tconst uv: Point2 = [\n\t\t\t\tFACE_UV[(i * 2 + 0) % FACE_UV.length],\n\t\t\t\tFACE_UV[(i * 2 + 1) % FACE_UV.length],\n\t\t\t];\n\n\t\t\tconst normal: Vector3 = [0.0, 0.0, 0.0];\n\t\t\tdata[i] = { position, uv, normal, color: [0.0, 1.0, 0.0, 1.0] };\n\t\t}\n\n\t\tsuper(data);\n\t\tthis.calculateNormals();\n\t}\n}\n\n// prettier-ignore\nconst FACE_UV = [\n\t1.0, 0.0,\n\t0.0, 0.0,\n\t1.0, 1.0,\n\n\t0.0, 1.0,\n\t1.0, 1.0,\n\t0.0, 0.0,\n];\n\n// prettier-ignore\nconst FACE_VERTICES = [\n\t// Far\n\t-1.0, 1.0, -1.0,\n\t1.0, 1.0, -1.0,\n\t-1.0, -1.0, -1.0,\n\n\t1.0, -1.0, -1.0,\n\t-1.0, -1.0, -1.0,\n\t1.0, 1.0, -1.0,\n\n\t// Near\n\t1.0, 1.0, 1.0,\n\t-1.0, 1.0, 1.0,\n\t1.0, -1.0, 1.0,\n\n\t-1.0, -1.0, 1.0,\n\t1.0, -1.0, 1.0,\n\t-1.0, 1.0, 1.0,\n\n\t// Left\n\t-1.0, 1.0, 1.0,\n\t-1.0, 1.0, -1.0,\n\t-1.0, -1.0, 1.0,\n\n\t-1.0, -1.0, -1.0,\n\t-1.0, -1.0, 1.0,\n\t-1.0, 1.0, -1.0,\n\n\t// Right\n\t1.0, 1.0, -1.0,\n\t1.0, 1.0, 1.0,\n\t1.0, -1.0, -1.0,\n\n\t1.0, -1.0, 1.0,\n\t1.0, -1.0, -1.0,\n\t1.0, 1.0, 1.0,\n\n\t// Top\n\t1.0, 1.0, -1.0,\n\t-1.0, 1.0, -1.0,\n\t1.0, 1.0, 1.0,\n\n\t-1.0, 1.0, 1.0,\n\t1.0, 1.0, 1.0,\n\t-1.0, 1.0, -1.0,\n\n\t// Bottom\n\t1.0, -1.0, -1.0,\n\t1.0, -1.0, 1.0,\n\t-1.0, -1.0, -1.0,\n\n\t-1.0, -1.0, 1.0,\n\t-1.0, -1.0, -1.0,\n\t1.0, -1.0, 1.0,\n];\n","import { Mesh } from '../mesh';\nimport { Point2, Point3, Vector3, Matrix4 } from '../geom';\n\ntype Face = [number[], number[], number[]];\n\nexport type ObjVertex = {\n\tposition: Point3;\n\tnormal: Vector3;\n\tuv: Point2;\n};\n\nexport interface ObjOptions {\n\tflipFaces?: boolean;\n\tscale?: number;\n}\n\nexport interface ObjFile {\n\tvertices: Point3[];\n\tnormals: Vector3[];\n\tuvs: Point2[];\n}\n\nexport class Obj extends Mesh<ObjVertex> {\n\tconstructor(data: string, options?: ObjOptions) {\n\t\tlet { vertices, normals, uvs } = parseObj(data);\n\t\tif (options?.scale) {\n\t\t\tconst scaling = Matrix4.scaling(options.scale, options.scale, options.scale);\n\t\t\tvertices = vertices.map((v) => scaling.transformPoint3(v));\n\t\t}\n\t\tif (options?.flipFaces) {\n\t\t\tfor (let i = 0; i < vertices.length; i += 3) {\n\t\t\t\tconst v0 = vertices[i];\n\t\t\t\tconst v1 = vertices[i + 2];\n\t\t\t\tvertices[i] = v1;\n\t\t\t\tvertices[i + 2] = v0;\n\t\t\t}\n\t\t}\n\n\t\tconst geom: ObjVertex[] = vertices.map((position, i) => {\n\t\t\treturn {\n\t\t\t\tposition,\n\t\t\t\tnormal: normals[i],\n\t\t\t\tuv: uvs[i],\n\t\t\t};\n\t\t});\n\t\tsuper(geom);\n\t}\n\n\tstatic async fromUrl(url: string): Promise<Obj> {\n\t\tconst response = await fetch(url);\n\t\tconst data = await response.text();\n\t\treturn new Obj(data);\n\t}\n}\n\nfunction parseObj(data: string): ObjFile {\n\tconst vertices: Point3[] = [];\n\tconst faces: Face[] = [];\n\tconst normals: Vector3[] = [];\n\tconst uvs: Point2[] = [];\n\n\tfor (const line of data.split('\\n')) {\n\t\tconst leader = line.split(' ')[0];\n\t\tswitch (leader) {\n\t\t\t// Vertex\n\t\t\tcase 'v':\n\t\t\t\tvertices.push(parseObjVertex(line));\n\t\t\t\tbreak;\n\n\t\t\t// Face\n\t\t\tcase 'f':\n\t\t\t\tfaces.push(parseObjFace(line));\n\t\t\t\tbreak;\n\n\t\t\t// Vertex Texture\n\t\t\tcase 'vt':\n\t\t\t\tuvs.push(parseObjUV(line));\n\t\t\t\tbreak;\n\n\t\t\t// Vertex Normal\n\t\t\tcase 'vn':\n\t\t\t\tnormals.push(parseObjNormal(line));\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\tvertices: (faces as any).flat().map((f: number[]) => vertices[f[0]]),\n\t\tnormals: (faces as any).flat().map((f: number[]) => normals[f[2]]),\n\t\tuvs: (faces as any).flat().map((f: number[]) => uvs[f[1]]),\n\t};\n}\n\nfunction parseObjVertex(line: string): Point3 {\n\treturn line\n\t\t.split(' ')\n\t\t.filter((s) => s)\n\t\t.slice(1)\n\t\t.map(parseFloat) as Point3;\n}\n\nfunction parseObjNormal(line: string): Vector3 {\n\treturn line\n\t\t.split(' ')\n\t\t.filter((s) => s)\n\t\t.slice(1)\n\t\t.map(parseFloat) as Vector3;\n}\n\nfunction parseObjUV(line: string): Point2 {\n\tconst p = line\n\t\t.split(' ')\n\t\t.filter((s) => s)\n\t\t.slice(1)\n\t\t.map(i => parseFloat(i)) as Point2;\n\n\treturn [p[0], 1 - p[1]];\n}\n\nfunction parseObjFace(line: string): Face {\n\treturn line\n\t\t.split(' ')\n\t\t.filter((s) => s)\n\t\t.slice(1)\n\t\t.map((f) => f.split('/').map(i => parseInt(i, 10) - 1)) as Face;\n}\n","import { Mesh } from '../mesh';\nimport { Point3, Point2, Vector3 } from '../geom';\nimport { Color } from '../material';\n\nexport type Vertex = {\n\tposition: Point3;\n\tuv: Point2;\n\tcolor: Color;\n\tnormal: Vector3;\n};\n\nexport class Quad extends Mesh<Vertex> {\n\tconstructor() {\n\t\tsuper([\n\t\t\t{ position: [1.0, 1.0, 0.0], uv: [1.0, 0.0], color: [0.0, 0.0, 0.0, 1.0], normal: [0.0, 0.0, 1.0] },\n\t\t\t{ position: [-1.0, 1.0, 0.0], uv: [0.0, 0.0], color: [0.0, 0.0, 0.0, 1.0], normal: [0.0, 0.0, 1.0] },\n\t\t\t{ position: [1.0, -1.0, 0.0], uv: [1.0, 1.0], color: [0.0, 0.0, 0.0, 1.0], normal: [0.0, 0.0, 1.0] },\n\n\t\t\t{ position: [-1.0, -1.0, 0.0], uv: [0.0, 1.0], color: [0.0, 0.0, 0.0, 1.0], normal: [0.0, 0.0, 1.0] },\n\t\t\t{ position: [1.0, -1.0, 0.0], uv: [1.0, 1.0], color: [0.0, 0.0, 0.0, 1.0], normal: [0.0, 0.0, 1.0] },\n\t\t\t{ position: [-1.0, 1.0, 0.0], uv: [0.0, 0.0], color: [0.0, 0.0, 0.0, 1.0], normal: [0.0, 0.0, 1.0] },\n\t\t]);\n\t\tthis.calculateNormals();\n\t}\n}\n","import { Mesh, Geometry } from '../mesh';\nimport { Point3, Point2, Vector3, normalize, cross, addVector3, multiplyVector3 } from '../geom';\nimport { Color } from '../material';\n\nexport type SphereVertex = {\n\tposition: Point3;\n\tuv: Point2;\n\tnormal: Vector3;\n\tcolor: Color;\n};\n\nexport class Sphere extends Mesh<SphereVertex> {\n\tconstructor(lonSegments: number, latSegments: number) {\n\t\tconst data: SphereVertex[] = new Array(lonSegments * latSegments * 6);\n\n\t\tlet i = 0;\n\t\tfor (let y = latSegments * -0.5; y < latSegments * 0.5; y++) {\n\t\t\tconst lat0 = Math.PI * (y / latSegments);\n\t\t\tconst lat1 = Math.PI * ((y + 1) / latSegments);\n\n\t\t\tfor (let x = lonSegments * -0.5; x < lonSegments * 0.5; x++) {\n\t\t\t\tconst lon0 = 2 * Math.PI * (x / lonSegments);\n\t\t\t\tconst lon1 = 2 * Math.PI * ((x + 1) / lonSegments);\n\n\t\t\t\tconst quad: [number, number][] = [\n\t\t\t\t\t[lon1, lat1],\n\t\t\t\t\t[lon0, lat1],\n\t\t\t\t\t[lon0, lat0],\n\t\t\t\t\t[lon1, lat0],\n\t\t\t\t\t[lon1, lat1],\n\t\t\t\t\t[lon0, lat0],\n\t\t\t\t];\n\n\t\t\t\tfor (const p of quad) {\n\t\t\t\t\tconst position = sphericalToCartesian(p[0], p[1]);\n\t\t\t\t\tconst normal = normalize(position);\n\t\t\t\t\tconst vertex: SphereVertex = {\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tnormal,\n\t\t\t\t\t\tuv: sphericalToUV(p[0], p[1]),\n\t\t\t\t\t\tcolor: [1.0, 0.0, 0.0, 1.0],\n\t\t\t\t\t};\n\n\t\t\t\t\tdata[i++] = vertex;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsuper(data);\n\t}\n}\n\nexport class CubeSphere extends Mesh<SphereVertex> {\n\tconstructor(res: number) {\n\t\tsuper([\n\t\t\tnew CubeSphereFace(res, [0, 1, 0]),\n\t\t\tnew CubeSphereFace(res, [0, -1, 0]),\n\n\t\t\tnew CubeSphereFace(res, [1, 0, 0]),\n\t\t\tnew CubeSphereFace(res, [-1, 0, 0]),\n\n\t\t\tnew CubeSphereFace(res, [0, 0, 1]),\n\t\t\tnew CubeSphereFace(res, [0, 0, -1]),\n\t\t]);\n\t}\n}\n\nexport class CubeSphereFace extends Geometry<SphereVertex> {\n\tconstructor(res: number, up: Point3) {\n\t\tconst data: SphereVertex[] = new Array(res * res);\n\t\tconst axisA: Point3 = [up[1], up[2], up[0]];\n\t\tconst axisB = cross(up, axisA);\n\n\t\tconst vertices = new Array(res * res);\n\t\tconst triangles = new Array((res - 1) * (res - 1));\n\n\t\tlet tri = 0;\n\t\tconst sub = 1 / (res - 1);\n\t\tfor (let y = 0; y < res; y++) {\n\t\t\tfor (let x = 0; x < res; x++) {\n\t\t\t\tconst p: Point2 = [\n\t\t\t\t\tx * sub,\n\t\t\t\t\ty * sub,\n\t\t\t\t];\n\t\t\t\tconst hp = [\n\t\t\t\t\t(p[0] - 0.5) * 2.0,\n\t\t\t\t\t(p[1] - 0.5) * 2.0,\n\t\t\t\t];\n\t\t\t\tlet position = up;\n\t\t\t\tposition = addVector3(position, multiplyVector3([hp[0], hp[0], hp[0]], axisA));\n\t\t\t\tposition = addVector3(position, multiplyVector3([hp[1], hp[1], hp[1]], axisB));\n\t\t\t\tposition = normalize(position);\n\t\t\t\tconst vertex: SphereVertex = {\n\t\t\t\t\tposition,\n\t\t\t\t\tnormal: position,\n\t\t\t\t\tuv: [0, 0],\n\t\t\t\t\tcolor: [1.0, 0.0, 0.0, 1.0],\n\t\t\t\t};\n\t\t\t\tconst i = x + y * res;\n\t\t\t\tvertices[i] = vertex;\n\n\t\t\t\tif (x < res - 1 && y < res - 1) {\n\t\t\t\t\ttriangles[tri++] = i;\n\t\t\t\t\ttriangles[tri++] = i + res + 1;\n\t\t\t\t\ttriangles[tri++] = i + res;\n\t\t\t\t\ttriangles[tri++] = i;\n\t\t\t\t\ttriangles[tri++] = i + 1;\n\t\t\t\t\ttriangles[tri++] = i + res + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < triangles.length; i++) {\n\t\t\tdata[i] = vertices[triangles[i]];\n\t\t}\n\t\tsuper(data);\n\t}\n}\n\nfunction sphericalToCartesian(lon: number, lat: number): Point3 {\n\treturn [\n\t\tMath.cos(lat) * Math.sin(lon),\n\t\tMath.sin(lat),\n\t\tMath.cos(lat) * Math.cos(lon),\n\t];\n}\n\nfunction sphericalToUV(lon: number, lat: number): Point2 {\n\tconst x = lon / Math.PI / 2 + 0.5;\n\tconst y = -lat / Math.PI + 0.5;\n\treturn [x, y];\n}\n","import { Texture } from './texture';\n\nexport enum Attachment {\n\tCOLOR,\n\tDEPTH,\n}\n\nexport class RenderTexture extends Texture {\n\tsize: number;\n\tattachment: Attachment;\n\n\tconstructor(size: number, attachment: Attachment = Attachment.COLOR) {\n\t\tsuper();\n\t\tthis.attachment = attachment;\n\t\tthis.size = size;\n\t\tconst pixels = new Uint8ClampedArray(size * size * 4);\n\t\tpixels.fill(255);\n\t\tthis.putPixels(new ImageData(pixels, size));\n\t}\n}\n","export { Renderer } from './renderer';\n","import { Mesh } from '../mesh';\nimport { Instance } from '../actor';\nimport { Scene } from '../scene';\nimport { Texture } from '../texture';\nimport { Camera, BasicCamera } from '../camera';\nimport { RenderTexture } from '../render_texture';\nimport { Color } from '../material';\n\nexport abstract class Renderer {\n\tcamera: Camera = new BasicCamera();\n\tmousePosition = [0.0, 0.0];\n\tmouseMovement = [0.0, 0.0];\n\twheelMovement = [0.0, 0.0];\n\tmouseButtons = new Set();\n\theldKeys = new Set();\n\tbackgroundColor: Color = [0.0, 0.0, 0.0, 1.0];\n\tupdateSize(_width?: number, _height?: number): void {}\n\tresetMouseMovement() {\n\t\tthis.mouseMovement[0] = 0;\n\t\tthis.mouseMovement[1] = 0;\n\t\tthis.wheelMovement[0] = 0;\n\t\tthis.wheelMovement[1] = 0;\n\t}\n\taddEventListener(_type: string, _listener: EventListenerOrEventListenerObject, _options?: AddEventListenerOptions): void {}\n\tremoveEventListener(_type: string, _listener: EventListenerOrEventListenerObject, _options?: EventListenerOptions): void {}\n\tget isDragging(): boolean {\n\t\treturn false;\n\t}\n\tabstract uploadMesh(mesh: Mesh): void;\n\tabstract uploadMeshInstances<I extends Instance = Instance>(mesh: Mesh, instances: I[]): void;\n\tabstract uploadTexture(texture: Texture, unit?: number): number;\n\tabstract bindTexture(texture: Texture): number;\n\tabstract unbindTexture(texture: Texture): void;\n\tabstract async drawScene(scene: Scene, target?: RenderTexture): Promise<number>;\n\tabstract get width(): number;\n\tabstract get height(): number;\n}\n","import { Matrix4 } from '../geom';\nimport { Vertex } from './vertex';\nimport { Mesh } from '../mesh';\nimport { Instance } from '../actor';\n\nconst FLOAT32_SIZE: number = 4;\n\nexport class WebGLMesh<T extends Vertex = Vertex> {\n\tbuffer: WebGLBuffer;\n\tstride: number;\n\toffsets: Map<keyof T, number> = new Map();\n\tlength: number;\n\tinstanceBuffer: WebGLBuffer;\n\tinstanceStride: number;\n\tinstanceOffsets: Map<keyof T, number> = new Map();\n\tinstanceLength: number;\n\tgl: WebGLRenderingContext;\n\n\tconstructor(gl: WebGLRenderingContext) {\n\t\tthis.gl = gl;\n\t}\n\n\tupload(mesh: Mesh<T>): Promise<void> {\n\t\tconst gl = this.gl;\n\t\tif (!this.buffer) {\n\t\t\tthis.buffer = gl.createBuffer();\n\t\t}\n\n\t\tconst vertices = mesh.vertices;\n\t\tthis.length = vertices.length;\n\t\tif (vertices.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst attributeNames = Object.keys(vertices[0]).sort();\n\n\t\t// Calculate offsets, stride, and vertex size\n\t\tlet vertexSize = 0;\n\t\tfor (const name of attributeNames) {\n\t\t\tconst attr = vertices[0][name];\n\t\t\tthis.offsets.set(name, vertexSize * FLOAT32_SIZE);\n\t\t\tif (Array.isArray(attr)) {\n\t\t\t\tvertexSize += attr.length;\n\t\t\t} else {\n\t\t\t\tvertexSize += 1;\n\t\t\t}\n\t\t}\n\t\tthis.stride = vertexSize * FLOAT32_SIZE;\n\n\t\t// Convert Array<Vertex> into Float32Array\n\t\tlet i = 0;\n\t\tconst data = new Float32Array(vertices.length * vertexSize);\n\t\tfor (const vertex of vertices) {\n\t\t\tfor (const attr of attributeNames) {\n\t\t\t\tconst value = vertex[attr];\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tfor (const num of value) {\n\t\t\t\t\t\tdata[i] = num;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdata[i] = value;\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Upload data to the GPU\n\t\tthis.bind();\n\t\tgl.bufferData(gl.ARRAY_BUFFER, data, gl.DYNAMIC_DRAW);\n\t}\n\n\tuploadInstances<I extends Instance>(instances: I[]) {\n\t\tif (instances.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst gl = this.gl;\n\n\t\tconst attributeNames = Object.keys(instances[0]).sort();\n\n\t\t// Calculate offsets, stride, and instance size\n\t\tlet instanceSize = 0;\n\t\tfor (const name of attributeNames) {\n\t\t\tconst attr = instances[0][name];\n\t\t\tthis.instanceOffsets.set(name, instanceSize * FLOAT32_SIZE);\n\t\t\tif (Array.isArray(attr)) {\n\t\t\t\tinstanceSize += attr.length;\n\t\t\t} else if (attr instanceof Matrix4) {\n\t\t\t\tinstanceSize += attr.toArray().length;\n\t\t\t} else {\n\t\t\t\tinstanceSize += 1;\n\t\t\t}\n\t\t}\n\t\tthis.instanceStride = instanceSize * FLOAT32_SIZE;\n\n\t\t// Convert Array<Instance> into Float32Array\n\t\tlet i = 0;\n\t\tconst data = new Float32Array(instances.length * instanceSize);\n\t\tfor (const instance of instances) {\n\t\t\tfor (const attr of attributeNames) {\n\t\t\t\tconst value = instance[attr];\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tfor (const num of value) {\n\t\t\t\t\t\tdata[i] = num;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t} else if (value instanceof Matrix4) {\n\t\t\t\t\tfor (const num of value.toArray()) {\n\t\t\t\t\t\tdata[i] = num;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdata[i] = value;\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this.instanceBuffer) {\n\t\t\tthis.instanceBuffer = gl.createBuffer();\n\t\t}\n\n\t\tthis.instanceLength = instances.length;\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.instanceBuffer);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, data, gl.DYNAMIC_DRAW);\n\t}\n\n\tbind() {\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.buffer);\n\t}\n\n\tdraw() {\n\t\tthis.gl.drawArrays(this.gl.TRIANGLES, 0, this.length);\n\t}\n\n\tdrawLines() {\n\t\tthis.gl.lineWidth(1);\n\t\tthis.gl.drawArrays(this.gl.LINE_STRIP, 0, this.length);\n\t}\n\n\tdrawInstances() {\n\t\tconst ext = this.gl.getExtension('ANGLE_instanced_arrays');\n\t\text.drawArraysInstancedANGLE(this.gl.TRIANGLES, 0, this.length, this.instanceLength);\n\t}\n}\n","import { WebGLRendererTexture } from './webgl_texture';\n\nexport class WebGLRenderTarget {\n\tgl: WebGLRenderingContext;\n\ttexture: WebGLRendererTexture;\n\tsize: number;\n\tframebuffer: WebGLFramebuffer;\n\trenderbuffer: WebGLRenderbuffer;\n\tattachment =  WebGLRenderingContext.COLOR_ATTACHMENT0;\n\n\tconstructor(gl: WebGLRenderingContext, size: number, texture: WebGLRendererTexture) {\n\t\tthis.gl = gl;\n\t\tthis.size = size;\n\t\tthis.texture = texture;\n\t\tthis.framebuffer = gl.createFramebuffer();\n\t\tthis.renderbuffer = gl.createRenderbuffer();\n\t}\n\n\tbind() {\n\t\tconst gl = this.gl;\n\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\n\n\t\tgl.framebufferTexture2D(\n\t\t\tgl.FRAMEBUFFER,\n\t\t\tthis.attachment,\n\t\t\tgl.TEXTURE_2D,\n\t\t\tthis.texture.texture,\n\t\t\t0,\n\t\t);\n\n\t\tif (this.attachment == WebGLRenderingContext.DEPTH_ATTACHMENT) {\n\t\t\t// Safari requries a Color texture, even if we're only rendering to a Depth texture\n\t\t\tgl.framebufferTexture2D(\n\t\t\t\tgl.FRAMEBUFFER,\n\t\t\t\tgl.COLOR_ATTACHMENT0,\n\t\t\t\tgl.TEXTURE_2D,\n\t\t\t\tthis.texture.unusedColorTexture,\n\t\t\t\t0,\n\t\t\t);\n\t\t} else {\n\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, this.renderbuffer);\n\t\t\tgl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.size, this.size);\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, this.renderbuffer);\n\t\t}\n\t}\n\n\tunbind() {\n\t\tconst gl = this.gl;\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t}\n}\n","import { Renderer } from './renderer';\nimport { Shader, ShaderOptions } from '../shader';\nimport { Vertex } from './vertex';\nimport { Actor, Instance } from '../actor';\nimport { Matrix4 } from '../geom';\nimport { Mesh } from '../mesh';\nimport { Scene } from '../scene';\nimport { Texture } from '../texture';\nimport { UniformValues } from '../shader';\nimport { WebGLMesh } from './webgl_mesh';\nimport { WebGLRendererTexture } from './webgl_texture';\nimport { WebGLRenderTarget } from './webgl_render_target';\nimport { StaticMesh } from '../components/static_mesh';\nimport { Light } from '../components/light';\nimport { RenderTexture, Attachment } from '../render_texture';\nimport defaultVertSource from '../shaders/wireframe.vert.glsl';\nimport defaultFragSource from '../shaders/wireframe.frag.glsl';\n\nconst DEBUG_ENABLED = !PRODUCTION || window.location.search.indexOf('debug') !== -1;\n\ntype ExtWheelEvent = WheelEvent & { wheelDelta: number, axis: number, HORIZONTAL_AXIS: 0x01, VERTICAL_AXIS: 0x02 };\n\nexport class WebGLRenderer extends Renderer {\n\tcanvas: HTMLCanvasElement;\n\tdebugEl: HTMLElement;\n\tdefaultShader: Shader;\n\tscale = 1.0 * window.devicePixelRatio;\n\tlineWidth = 2 * window.devicePixelRatio;\n\tantiAlias = true;\n\tvsync = true;\n\tlastFrameAt = 0;\n\tframeAverage = 0;\n\tframe = 0;\n\tisGrabbed = false;\n\tseed = Math.random();\n\tprivate dragDelta = [0, 0];\n\tprivate context: WebGLRenderingContext;\n\tprivate textures: Map<Texture, WebGLRendererTexture> = new Map();\n\tprivate meshes: Map<Mesh<Vertex>, WebGLMesh<Vertex>> = new Map();\n\tprivate renderTargets: Map<RenderTexture, WebGLRenderTarget> = new Map();\n\n\tconstructor(el: HTMLElement) {\n\t\tsuper();\n\t\tif (el instanceof HTMLCanvasElement) {\n\t\t\tthis.canvas = el;\n\t\t} else {\n\t\t\tthis.canvas = document.createElement('canvas');\n\t\t\tif (el instanceof HTMLElement) {\n\t\t\t\tthis.attach(el);\n\t\t\t}\n\t\t}\n\n\t\tObject.assign(this.canvas.style, {\n\t\t\tposition: 'fixed',\n\t\t\tleft: 0,\n\t\t\tright: 0,\n\t\t\ttop: 0,\n\t\t\tbottom: 0,\n\t\t});\n\t}\n\n\tget isDragging(): boolean {\n\t\tif (Math.abs(this.dragDelta[0]) > 4 || Math.abs(this.dragDelta[1]) > 4) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * The canvas's parent element\n\t */\n\tget parentElement(): HTMLCanvasElement['parentElement'] {\n\t\treturn this.canvas.parentElement;\n\t}\n\n\t/**\n\t * The WebGL drawing context\n\t */\n\tget gl(): WebGLRenderingContext {\n\t\tif (this.context) {\n\t\t\treturn this.context;\n\t\t}\n\n\t\tconst options = {\n\t\t\tantialias: this.antiAlias,\n\t\t};\n\n\t\tthis.context = this.canvas.getContext('webgl', options) as WebGLRenderingContext;\n\t\tif (!this.context) {\n\t\t\tthis.parentElement.innerHTML = 'Failed to create a WebGL context';\n\t\t\tthrow 'Failed to create WebGL context';\n\t\t}\n\n\t\treturn this.context;\n\t}\n\n\tget width(): number {\n\t\treturn this.canvas.clientWidth;\n\t}\n\n\tget height(): number {\n\t\treturn this.canvas.clientHeight;\n\t}\n\n\t/**\n\t * Creates the WebGL buffers, compiles the shaders, etc.\n\t */\n\tprivate initWebGL() {\n\t\tconst gl = this.gl;\n\n\t\tgl.enable(gl.DEPTH_TEST);\n\t\tgl.enable(gl.BLEND);\n\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\t\tthis.defaultShader = this.createShader(defaultVertSource, defaultFragSource);\n\t}\n\n\tgrab(lock: boolean = false) {\n\t\tif (lock) {\n\t\t\tthis.canvas.requestPointerLock();\n\t\t}\n\t\tthis.isGrabbed = true;\n\t\tthis.addEventListeners();\n\t}\n\n\trelease() {\n\t\tthis.isGrabbed = false;\n\t\tdocument.exitPointerLock();\n\t\tthis.removeEventListeners();\n\t}\n\n\tprivate addEventListeners() {\n\t\tdocument.addEventListener('pointerlockchange', this.onPointerLockChange);\n\t\twindow.addEventListener('keydown', this.onKeyDown);\n\t\twindow.addEventListener('keyup', this.onKeyUp);\n\t\twindow.addEventListener('mousemove', this.onMouseMove);\n\t\twindow.addEventListener('mouseup', this.onMouseUp);\n\t\twindow.addEventListener('mousedown', this.onMouseDown);\n\t\twindow.addEventListener('wheel', this.onWheel, { passive: false });\n\t\twindow.addEventListener('DOMMouseScroll', this.onWheel, { passive: false });\n\t}\n\n\tprivate removeEventListeners() {\n\t\tthis.heldKeys.clear();\n\t\tdocument.removeEventListener('pointerlockchange', this.onPointerLockChange);\n\t\twindow.removeEventListener('keydown', this.onKeyDown);\n\t\twindow.removeEventListener('keyup', this.onKeyUp);\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\n\t\twindow.removeEventListener('mousedown', this.onMouseDown);\n\t\twindow.removeEventListener('wheel', this.onWheel);\n\t\twindow.removeEventListener('DOMMouseScroll', this.onWheel);\n\t}\n\n\tonPointerLockChange = () => {\n\t\tif (!this.isGrabbed) {\n\t\t\tthis.removeEventListeners();\n\t\t}\n\t};\n\n\tonKeyDown = (e: KeyboardEvent) => {\n\t\tthis.heldKeys.add(e.key.toLowerCase());\n\t};\n\n\tonKeyUp = (e: KeyboardEvent) => {\n\t\tthis.heldKeys.delete(e.key.toLowerCase());\n\t};\n\n\tonMouseDown = (e: MouseEvent) => {\n\t\tthis.dragDelta[0] = 0;\n\t\tthis.dragDelta[1] = 0;\n\t\tthis.mouseButtons.add(e.button);\n\t};\n\n\tonMouseUp = (e: MouseEvent) => {\n\t\tsetTimeout(() => {\n\t\t\tthis.dragDelta[0] = 0;\n\t\t\tthis.dragDelta[1] = 0;\n\t\t}, 1);\n\t\tthis.mouseButtons.delete(e.button);\n\t};\n\n\tonMouseMove = (e: MouseEvent) => {\n\t\tif (this.mouseButtons.size > 0) {\n\t\t\tthis.dragDelta[0] += e.movementX;\n\t\t\tthis.dragDelta[1] += e.movementY;\n\t\t}\n\t\tthis.mousePosition[0] = e.clientX;\n\t\tthis.mousePosition[1] = e.clientY;\n\t\tthis.mouseMovement[0] += e.movementX;\n\t\tthis.mouseMovement[1] += e.movementY;\n\t};\n\n\tonWheel = (e: ExtWheelEvent) => {\n\t\t// Ignore Firefox 'onwheel'\n\t\tif (!e.axis && !e.wheelDelta) return;\n\t\te.preventDefault();\n\n\t\tlet dx = 0;\n\t\tlet dy = 0;\n\n\t\tif (!e.wheelDelta && e.detail) {\n\t\t\t// Firefox (DOMMouseScroll)\n\t\t\tconst amount = e.detail * 53 / 3;\n\t\t\tif (e.axis === e.HORIZONTAL_AXIS) {\n\t\t\t\tdx = amount;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdy = amount;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Proper wheel event\n\t\t\tdx = e.deltaX;\n\t\t\tdy = e.deltaY;\n\t\t}\n\n\t\tthis.wheelMovement[0] += dx;\n\t\tthis.wheelMovement[1] += dy;\n\t};\n\n\tclear() {\n\t\tconst gl = this.gl;\n\t\tgl.clearDepth(1.0);\n\t\tgl.clearColor(...this.backgroundColor);\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\t}\n\n\tdrawActorWithShader(shader: Shader, actor: Actor, projection?: Matrix4, options: { parentModel?: Matrix4 } = {}) {\n\t\tif (!actor.visible) return;\n\t\tconst { model, material, children } = actor;\n\t\tconst { parentModel } = options;\n\n\t\tconst actorModel = parentModel ? parentModel.multiply(model) : model;\n\n\t\tif (material) {\n\t\t\tactor.uniforms['uMaterial.color'] = material.color.length === 3 ? [...material.color, 1.0] : material.color;\n\t\t\tactor.uniforms['uFillColor'] = actor.uniforms['uMaterial.color'];\n\t\t\tactor.uniforms['uMaterial.hasTexture'] = !!material.texture;\n\t\t\tactor.uniforms['uMaterial.hasNormalMap'] = !!material.normalMap;\n\t\t\tactor.uniforms['uMaterial.hasSpecularMap'] = !!material.specularMap;\n\t\t\tactor.uniforms['uMaterial.hasDisplacementMap'] = !!material.displacementMap;\n\t\t\tactor.uniforms['uMaterial.castsShadows'] = material.castsShadows;\n\t\t\tactor.uniforms['uMaterial.receivesShadows'] = material.receivesShadows;\n\t\t\tactor.uniforms['uMaterial.emissive'] = material.emissive;\n\t\t\tactor.uniforms['uMaterial.displacementMultiplier'] = material.displacementMultiplier;\n\t\t\tif (material.texture) {\n\t\t\t\tactor.uniforms['uMaterial.texture'] = this.bindTexture(material.texture);\n\t\t\t}\n\t\t\tif (material.normalMap) {\n\t\t\t\tactor.uniforms['uMaterial.normalMap'] = this.bindTexture(material.normalMap);\n\t\t\t}\n\t\t\tif (material.specularMap) {\n\t\t\t\tactor.uniforms['uMaterial.specularMap'] = this.bindTexture(material.specularMap);\n\t\t\t}\n\t\t\tif (material.displacementMap) {\n\t\t\t\tactor.uniforms['uMaterial.displacementMap'] = this.bindTexture(material.displacementMap);\n\t\t\t}\n\t\t}\n\n\t\tif (projection) {\n\t\t\tshader.setUniform('uViewProj', projection);\n\t\t}\n\t\tshader.setUniform('uModel', actorModel);\n\n\t\tfor (const uniformName in actor.uniforms) {\n\t\t\tshader.setUniform(uniformName, actor.uniforms[uniformName]);\n\t\t}\n\n\n\t\t// Find mesh to draw\n\t\tconst mesh = actor.getComponentsOfType(StaticMesh)[0]?.mesh;\n\t\tif (mesh) {\n\t\t\tlet glMesh = this.meshes.get(mesh);\n\t\t\tif (!glMesh) {\n\t\t\t\tthis.uploadMesh(mesh);\n\t\t\t\tglMesh = this.meshes.get(mesh);\n\t\t\t}\n\n\t\t\tshader.bind(glMesh);\n\t\t\tif (actor.hasInstances) {\n\t\t\t\tshader.bindInstances(this.gl, glMesh);\n\t\t\t\tglMesh.drawInstances();\n\t\t\t} else if (material.wireframe) {\n\t\t\t\tglMesh.drawLines();\n\t\t\t} else {\n\t\t\t\tglMesh.draw();\n\t\t\t}\n\t\t}\n\n\t\t// Draw children\n\t\tfor (const child of children) {\n\t\t\tthis.drawActorWithShader(shader, child, projection, { ...options, parentModel: actorModel });\n\t\t}\n\t}\n\n\tdrawActor(actor: Actor, projection?: Matrix4, options: { parentModel?: Matrix4, uniforms?: UniformValues } = {}) {\n\t\tif (!actor.visible) return;\n\t\tconst { model, material, children } = actor;\n\t\tconst { parentModel } = options;\n\t\tconst actorModel = parentModel ? parentModel.multiply(model) : model;\n\n\t\tif (material) {\n\t\t\tactor.uniforms['uMaterial.color'] = material.color.length === 3 ? [...material.color, 1.0] : material.color;\n\t\t\tactor.uniforms['uMaterial.hasTexture'] = !!material.texture;\n\t\t\tactor.uniforms['uMaterial.hasNormalMap'] = !!material.normalMap;\n\t\t\tactor.uniforms['uMaterial.hasSpecularMap'] = !!material.specularMap;\n\t\t\tactor.uniforms['uMaterial.hasDisplacementMap'] = !!material.displacementMap;\n\t\t\tactor.uniforms['uMaterial.castsShadows'] = material.castsShadows;\n\t\t\tactor.uniforms['uMaterial.receivesShadows'] = material.receivesShadows;\n\t\t\tactor.uniforms['uMaterial.emissive'] = material.emissive;\n\t\t\tactor.uniforms['uMaterial.displacementMultiplier'] = material.displacementMultiplier;\n\t\t\tif (material.texture) {\n\t\t\t\tactor.uniforms['uMaterial.texture'] = this.bindTexture(material.texture);\n\t\t\t}\n\t\t\tif (material.normalMap) {\n\t\t\t\tactor.uniforms['uMaterial.normalMap'] = this.bindTexture(material.normalMap);\n\t\t\t}\n\t\t\tif (material.specularMap) {\n\t\t\t\tactor.uniforms['uMaterial.specularMap'] = this.bindTexture(material.specularMap);\n\t\t\t}\n\t\t\tif (material.displacementMap) {\n\t\t\t\tactor.uniforms['uMaterial.displacementMap'] = this.bindTexture(material.displacementMap);\n\t\t\t}\n\t\t}\n\n\t\t// TODO support multiple meshes on one actor?\n\t\tconst mesh = actor.getComponentsOfType(StaticMesh)[0]?.mesh;\n\n\t\tif (actor.shader && !actor.shader.compiled) {\n\t\t\tactor.shader.make(this.gl);\n\t\t}\n\n\t\t// FIXME reuse this\n\t\tconst view = this.camera.view.inverse();\n\n\t\tif (mesh instanceof Mesh) {\n\t\t\tconst gl = this.gl;\n\t\t\tconst shader = actor.shader || this.defaultShader;\n\t\t\tconst uniforms = shader.uniforms;\n\t\t\tshader.use();\n\n\t\t\tlet glMesh = this.meshes.get(mesh);\n\t\t\tif (!glMesh) {\n\t\t\t\tthis.uploadMesh(mesh);\n\t\t\t\tglMesh = this.meshes.get(mesh);\n\t\t\t}\n\n\t\t\t// FIXME deprecate all this\n\t\t\tif (projection) {\n\t\t\t\tgl.uniformMatrix4fv(uniforms.uViewProj.location, false, projection.toArray());\n\t\t\t}\n\t\t\tgl.uniformMatrix4fv(uniforms.uView.location, false, view.toArray());\n\t\t\tgl.uniform4fv(uniforms.uFogColor.location, this.backgroundColor);\n\t\t\tgl.uniform1f(uniforms.uLineWidth.location, this.lineWidth);\n\t\t\tgl.uniform1f(uniforms.uTime.location, performance.now());\n\t\t\tgl.uniform2fv(uniforms.uResolution.location, [this.camera.width, this.camera.height]);\n\t\t\tgl.uniform1f(uniforms.uSeed.location, this.seed);\n\t\t\tgl.uniformMatrix4fv(uniforms.uModel.location, false, actorModel.toArray());\n\t\t\tif (material?.color) {\n\t\t\t\tgl.uniform4fv(uniforms.uFillColor.location, actor.uniforms['uMaterial.color'] as number[]);\n\t\t\t}\n\n\t\t\tif (options?.uniforms) {\n\t\t\t\tfor (const uniformName in options.uniforms) {\n\t\t\t\t\tif (shader.uniforms[uniformName]) {\n\t\t\t\t\t\tshader.setUniform(uniformName, options.uniforms[uniformName]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const uniformName in actor.uniforms) {\n\t\t\t\tshader.setUniform(uniformName, actor.uniforms[uniformName]);\n\t\t\t}\n\n\n\t\t\tshader.bind(glMesh);\n\t\t\tif (actor.hasInstances) {\n\t\t\t\tshader.bindInstances(gl, glMesh);\n\t\t\t\tglMesh.drawInstances();\n\t\t\t} else {\n\t\t\t\tglMesh.draw();\n\t\t\t}\n\t\t}\n\n\t\tfor (const child of children) {\n\t\t\tthis.drawActor(child, projection, { ...options, parentModel: actorModel });\n\t\t}\n\t}\n\n\tuploadMesh(mesh: Mesh) {\n\t\tconst gl = this.gl;\n\n\t\t// Link a Mesh with its WebGLMesh\n\t\tlet glMesh = this.meshes.get(mesh);\n\t\tif (!glMesh) {\n\t\t\tglMesh = new WebGLMesh(gl);\n\t\t\tthis.meshes.set(mesh, glMesh);\n\t\t}\n\t\tglMesh.upload(mesh);\n\t}\n\n\tuploadMeshInstances<I extends Instance = Instance>(mesh: Mesh, instances: I[]) {\n\t\tconst gl = this.gl;\n\n\t\t// Link a Mesh with its WebGLMesh\n\t\tlet glMesh = this.meshes.get(mesh);\n\t\tif (!glMesh) {\n\t\t\tglMesh = new WebGLMesh(gl);\n\t\t\tthis.meshes.set(mesh, glMesh);\n\t\t\tglMesh.upload(mesh);\n\t\t}\n\t\tglMesh.uploadInstances(instances);\n\t}\n\n\tremoveMesh(mesh: Mesh<Vertex>) {\n\t\tconst glMesh = this.meshes.get(mesh);\n\t\tif (!glMesh) return;\n\t\tthrow 'not yet implemented';\n\t}\n\n\tuploadTexture(texture: Texture, unit: number = null): number {\n\t\tconst gl = this.gl;\n\n\t\t// Link a Texture with its WebGLRendererTexture\n\t\tlet glTexture = this.textures.get(texture);\n\t\tif (!glTexture) {\n\t\t\tglTexture = WebGLRendererTexture.fromTexture(gl, texture);\n\t\t\tthis.textures.set(texture, glTexture);\n\t\t}\n\t\tif (unit == null && glTexture.unit == null) {\n\t\t\tunit = this.textures.size - 1;\n\t\t}\n\t\tglTexture.upload(texture, unit != null ? unit : glTexture.unit);\n\n\t\treturn unit;\n\t}\n\n\tbindTexture(texture: Texture): number {\n\t\tlet glTexture = this.textures.get(texture);\n\t\tif (!glTexture) {\n\t\t\tthis.uploadTexture(texture);\n\t\t\tglTexture = this.textures.get(texture);\n\t\t}\n\t\treturn glTexture.bind();\n\t}\n\n\tunbindTexture(texture: Texture) {\n\t\tlet glTexture = this.textures.get(texture);\n\t\tif (!glTexture) {\n\t\t\treturn;\n\t\t}\n\t\tglTexture.unbind();\n\t}\n\n\tcreateShader(vertSource: string, fragSource: string, options?: ShaderOptions): Shader {\n\t\treturn new Shader(this.gl, vertSource, fragSource, options);\n\t}\n\n\t/**\n\t * Wait for next animation frame and redraw everything\n\t */\n\tasync drawScene(scene: Scene, target?: RenderTexture): Promise<number> {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst draw = () => {\n\t\t\t\tconst now = performance.now();\n\t\t\t\tconst dt = (now - this.lastFrameAt) / 1000.0;\n\t\t\t\tthis.drawSync(scene, target);\n\n\t\t\t\tthis.frame++;\n\t\t\t\tif (DEBUG_ENABLED && this.frame % 60 === 0) {\n\t\t\t\t\tconst frameRate = (performance.now() - this.frameAverage) / 60;\n\t\t\t\t\tthis.frameAverage = performance.now();\n\t\t\t\t\tconst fps = (1 / (frameRate / 1000)) | 0;\n\t\t\t\t\tthis.debugEl.innerHTML = `${fps} fps`;\n\t\t\t\t}\n\n\t\t\t\tresolve(dt);\n\t\t\t};\n\n\t\t\tif (target) {\n\t\t\t\tthis.drawSync(scene, target);\n\t\t\t\tresolve(0);\n\t\t\t} else if (this.vsync) {\n\t\t\t\twindow.requestAnimationFrame(draw);\n\t\t\t} else {\n\t\t\t\tsetTimeout(draw, 0);\n\t\t\t}\n\t\t});\n\t}\n\n\tdrawSync(scene: Scene, texture?: RenderTexture) {\n\t\t// Drawing to a texture\n\t\tlet target;\n\t\tif (texture) {\n\t\t\ttarget = this.renderTargets.get(texture);\n\t\t\tif (!target) {\n\t\t\t\tthis.uploadTexture(texture);\n\t\t\t\tconst glTexture = this.textures.get(texture);\n\t\t\t\ttarget = new WebGLRenderTarget(this.gl, texture.size, glTexture);\n\t\t\t\tif (texture.attachment === Attachment.DEPTH) {\n\t\t\t\t\ttarget.attachment = this.gl.DEPTH_ATTACHMENT;\n\t\t\t\t}\n\n\t\t\t\tthis.renderTargets.set(texture, target);\n\t\t\t}\n\t\t\t\n\t\t\t// Resize to match size of texture\n\t\t\tthis.updateSize(texture.size, texture.size);\n\t\t\ttarget.bind();\n\t\t}\n\n\t\tthis.backgroundColor = [...scene.backgroundColor];\n\t\tconst now = performance.now();\n\t\tthis.lastFrameAt = now;\n\n\t\tthis.gl.viewport(0, 0, this.camera.width, this.camera.height);\n\t\tthis.clear();\n\n\t\t// Uniforms\n\t\tconst proj = this.camera.projection.clone();\n\t\tconst view = this.camera.view.inverse();\n\t\tconst viewProj = proj.multiply(view);\n\n\t\t// Batch shaders together\n\t\tconst shaderMap = new Map<Shader, Actor[]>();\n\t\tfor (const actor of scene.actors) {\n\t\t\tconst shader = actor.shader;\n\t\t\tif (!shader) continue;\n\t\t\tif (!shaderMap.get(shader)) {\n\t\t\t\tshaderMap.set(shader, [])\n\t\t\t}\n\t\t\tshaderMap.get(shader).push(actor);\n\t\t}\n\n\t\tfor (const shader of shaderMap.keys()) {\n\t\t\tif (!shader.compiled) {\n\t\t\t\tshader.make(this.gl);\n\t\t\t}\n\t\t\tshader.use();\n\n\n\t\t\t// Various global uniforms\n\t\t\tshader.setUniform('uView', view);\n\t\t\tshader.setUniform('uFogColor', this.backgroundColor);\n\t\t\tshader.setUniform('uLineWidth', this.lineWidth);\n\t\t\tshader.setUniform('uTime', performance.now());\n\t\t\tshader.setUniform('uResolution', [this.camera.width, this.camera.height]);\n\t\t\tshader.setUniform('uSeed', this.seed);\n\n\t\t\t// Scene defined uniforms\n\t\t\tfor (const uniformName in scene.uniforms) {\n\t\t\t\tshader.setUniform(uniformName, scene.uniforms[uniformName]);\n\t\t\t}\n\n\t\t\t// Lights\n\t\t\tconst lightCount = scene.lights.length;\n\t\t\tshader.setUniform('uLightCount', lightCount);\n\t\t\tfor (let i = 0; i < lightCount; i++) {\n\t\t\t\tconst position = scene.lights[i].position;\n\t\t\t\tconst light = scene.lights[i].getComponentsOfType(Light)[0] as Light;\n\t\t\t\tshader.setUniform(`uLights[${i}].position`, position);\n\t\t\t\tshader.setUniform(`uLights[${i}].diffuse`, light.diffuse);\n\t\t\t\tshader.setUniform(`uLights[${i}].ambient`, light.ambient);\n\t\t\t}\n\n\t\t\t// Draw actors with this shader\n\t\t\tfor (const actor of shaderMap.get(shader)) {\n\t\t\t\tthis.drawActorWithShader(shader, actor, viewProj);\n\t\t\t}\n\t\t}\n\n\t\t// Cleanup after drawing to texture\n\t\tif (texture) {\n\t\t\ttarget.unbind();\n\t\t\t// FIXME depth attachment check is so we don't resize the light (which is assigned to this.camera)\n\t\t\tif (texture.attachment != Attachment.DEPTH) {\n\t\t\t\tthis.updateSize();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Update the framebuffer of the canvas to match its container's size\n\t */\n\tupdateSize(width?: number, height?: number) {\n\t\tif (!this.parentElement) {\n\t\t\treturn;\n\t\t}\n\t\tconst parentWidth = this.parentElement.clientWidth * this.scale | 0;\n\t\tconst parentHeight = this.parentElement.clientHeight * this.scale | 0;\n\t\twidth = width != null ? width : parentWidth;\n\t\theight = height != null ? height : parentHeight;\n\t\tthis.camera.resize(width, height);\n\n\t\tthis.canvas.style.imageRendering = 'crisp-edges'; // Firefox\n\t\tthis.canvas.style.imageRendering = 'pixelated'; // Webkit\n\t\tthis.canvas.style.width = this.parentElement.clientWidth + 'px';\n\t\tthis.canvas.style.height = this.parentElement.clientHeight + 'px';\n\t\tthis.canvas.setAttribute('width', parentWidth.toString());\n\t\tthis.canvas.setAttribute('height', parentHeight.toString());\n\t}\n\n\taddEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: AddEventListenerOptions) {\n\t\tif (!this.canvas) return;\n\t\tthis.canvas.addEventListener(type, listener, options);\n\t}\n\n\tremoveEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: EventListenerOptions) {\n\t\tif (!this.canvas) return;\n\t\tthis.canvas.removeEventListener(type, listener, options);\n\t}\n\n\t/**\n\t * Insert the canvas into a HTMLElement\n\t */\n\tattach(el: HTMLElement = null) {\n\t\tel?.appendChild(this.canvas);\n\t\twindow.addEventListener('resize', this.updateSize.bind(this, null, null));\n\t\tthis.updateSize();\n\t\tthis.initWebGL();\n\t\tthis.addEventListeners();\n\n\t\tif (DEBUG_ENABLED) {\n\t\t\tthis.debugEl = document.createElement('div');\n\t\t\tthis.canvas.parentElement?.appendChild(this.debugEl);\n\t\t\tObject.assign(this.debugEl.style, {\n\t\t\t\tposition: 'fixed',\n\t\t\t\tborderRadius: '12px',\n\t\t\t\tzIndex: 10,\n\t\t\t\tright: '10px',\n\t\t\t\ttop: '10px',\n\t\t\t\tcolor: 'red',\n\t\t\t\tfontSize: '32px',\n\t\t\t\tbackground: 'rgba(0, 0, 0, 0.5)',\n\t\t\t\tpadding: '10px',\n\t\t\t});\n\t\t}\n\t}\n}\n","import { Matrix4 } from '../geom';\nimport { WebGLMesh } from './webgl_mesh';\n\nexport interface ShaderOptions {\n\tattributes?: { [key: string]: WebGLAttribute };\n\tinstanceAttributes?: { [key: string]: WebGLAttribute };\n\tuniforms?: { [key: string]: WebGLUniform };\n}\n\nexport interface WebGLAttribute {\n\tlocation?: number;\n\tsize: number;\n\ttype: number;\n}\n\nexport interface WebGLUniform {\n\tlocation?: WebGLUniformLocation;\n\ttype: number;\n}\n\nexport type WebGLUniformMap = { [key: string]: WebGLUniform };\nexport type WebGLAttributeMap = { [key: string]: WebGLAttribute };\n\nexport class WebGLShader {\n\tgl: WebGLRenderingContext;\n\tcompiled = false;\n\tprogram: WebGLProgram;\n\tattributes: WebGLAttributeMap = {\n\t\tposition: {\n\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\tsize: 3,\n\t\t\tlocation: null,\n\t\t},\n\t};\n\tinstanceAttributes: WebGLAttributeMap = {\n\t};\n\tuniforms: WebGLUniformMap = {\n\t\tuTime: {\n\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\tlocation: null,\n\t\t},\n\t\tuViewProj: {\n\t\t\ttype: WebGLRenderingContext.FLOAT_MAT4,\n\t\t\tlocation: null,\n\t\t},\n\t\tuView: {\n\t\t\ttype: WebGLRenderingContext.FLOAT_MAT4,\n\t\t\tlocation: null,\n\t\t},\n\t\tuModel: {\n\t\t\ttype: WebGLRenderingContext.FLOAT_MAT4,\n\t\t\tlocation: null,\n\t\t},\n\t\tuFillColor: {\n\t\t\ttype: WebGLRenderingContext.FLOAT_VEC4,\n\t\t\tlocation: null,\n\t\t},\n\t\tuFogColor: {\n\t\t\ttype: WebGLRenderingContext.FLOAT_VEC4,\n\t\t\tlocation: null,\n\t\t},\n\t\tuLineWidth: {\n\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\tlocation: null,\n\t\t},\n\t\tuResolution: {\n\t\t\ttype: WebGLRenderingContext.FLOAT_VEC2,\n\t\t\tlocation: null,\n\t\t},\n\t\tuSeed: {\n\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\tlocation: null,\n\t\t},\n\t};\n\n\tconstructor(gl?: WebGLRenderingContext, vertSource?: string, fragSource?: string, options?: ShaderOptions) {\n\t\tif (gl) {\n\t\t\tthis.make(gl, vertSource, fragSource, options);\n\t\t}\n\t}\n\n\tmake(gl: WebGLRenderingContext, vertSource?: string, fragSource?: string, options?: ShaderOptions) {\n\t\tthis.gl = gl;\n\t\tif (!vertSource) {\n\t\t\tthrow 'You must provide vertex shader source code';\n\t\t}\n\t\tif (!fragSource) {\n\t\t\tthrow 'You must provide fragment shader source code';\n\t\t}\n\n\t\tconst program = gl.createProgram();\n\n\t\tif (options?.attributes) {\n\t\t\tthis.attributes = {\n\t\t\t\t...this.attributes,\n\t\t\t\t...options.attributes,\n\t\t\t};\n\t\t}\n\n\t\tif (options?.instanceAttributes) {\n\t\t\tthis.instanceAttributes = {\n\t\t\t\t...this.instanceAttributes,\n\t\t\t\t...options.instanceAttributes,\n\t\t\t};\n\t\t}\n\n\t\tif (options?.uniforms) {\n\t\t\tthis.uniforms = {\n\t\t\t\t...this.uniforms,\n\t\t\t\t...options.uniforms,\n\t\t\t};\n\t\t}\n\n\t\t// Enable `fwidth` in shader\n\t\tgl.getExtension('OES_standard_derivatives');\n\n\t\tconst vert = gl.createShader(gl.VERTEX_SHADER);\n\t\tgl.shaderSource(vert, vertSource);\n\t\tgl.attachShader(program, vert);\n\t\tgl.compileShader(vert);\n\t\t// Did the vertex shader compile?\n\t\tif (!gl.getShaderParameter(vert, gl.COMPILE_STATUS)) {\n\t\t\tconst info = gl.getShaderInfoLog(vert);\n\t\t\tthrow `Could not compile Vertex shader: ${info}`;\n\t\t}\n\n\t\tconst frag = gl.createShader(gl.FRAGMENT_SHADER);\n\t\tgl.shaderSource(frag, fragSource);\n\t\tgl.attachShader(program, frag);\n\t\tgl.compileShader(frag);\n\t\t// Did the fragment shader compile?\n\t\tif (!gl.getShaderParameter(frag, gl.COMPILE_STATUS)) {\n\t\t\tconst info = gl.getShaderInfoLog(frag);\n\t\t\tthrow `Could not compile Fragment shader: ${info}`;\n\t\t}\n\n\t\tgl.linkProgram(program);\n\t\t// Did the program link successfully?\n\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n\t\t\tconst info = gl.getProgramInfoLog(program);\n\t\t\tconst shaderName = this.constructor.name;\n\t\t\tthrow `Could not link WebGL program (${shaderName}): ${info}`;\n\t\t}\n\n\t\t// Uniform locations\n\t\tfor (const uniformName in this.uniforms) {\n\t\t\tthis.uniforms[uniformName].location = gl.getUniformLocation(program, uniformName);\n\t\t}\n\n\t\t// Attribute locations\n\t\tfor (const attributeName in this.attributes) {\n\t\t\tthis.attributes[attributeName].location = gl.getAttribLocation(program, attributeName);\n\t\t}\n\t\tfor (const attributeName in this.instanceAttributes) {\n\t\t\tthis.instanceAttributes[attributeName].location = gl.getAttribLocation(program, attributeName);\n\t\t}\n\n\t\tgl.enable(gl.CULL_FACE);\n\t\tgl.cullFace(gl.BACK);\n\n\t\tthis.program = program;\n\t\tthis.compiled = true;\n\t}\n\n\tuse() {\n\t\tthis.gl.useProgram(this.program);\n\t}\n\n\tbind(mesh: WebGLMesh) {\n\t\tconst gl = this.gl;\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, mesh.buffer);\n\t\tconst ext = gl.getExtension('ANGLE_instanced_arrays');\n\t\tfor (const attributeName in this.attributes) {\n\t\t\tconst attribute = this.attributes[attributeName];\n\t\t\tif (attribute.location == null || attribute.location === -1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\text.vertexAttribDivisorANGLE(attribute.location, 0);\n\n\t\t\tconst stride = mesh.stride;\n\t\t\tconst offset = mesh.offsets.get(attributeName);\n\t\t\tif (offset == null) {\n\t\t\t\tif (!PRODUCTION) {\n\t\t\t\t\tconsole.warn(`Unable to find attribute offset for ${attributeName}`);\n\t\t\t\t}\n\t\t\t\tgl.disableVertexAttribArray(attribute.location);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tgl.enableVertexAttribArray(attribute.location);\n\t\t\tgl.vertexAttribPointer(attribute.location, attribute.size, attribute.type, false, stride, offset);\n\t\t}\n\t}\n\n\tunbind() {\n\t\tconst gl = this.gl;\n\t\tfor (const attributeName in this.attributes) {\n\t\t\tconst attribute = this.attributes[attributeName];\n\t\t\tif (attribute.location == null || attribute.location === -1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tgl.disableVertexAttribArray(attribute.location);\n\t\t}\n\t}\n\n\tbindInstances(gl: WebGLRenderingContext, mesh: WebGLMesh) {\n\t\tconst ext = gl.getExtension('ANGLE_instanced_arrays');\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, mesh.instanceBuffer);\n\t\tfor (const attributeName in this.instanceAttributes) {\n\t\t\tconst attribute = this.instanceAttributes[attributeName];\n\t\t\tif (attribute.location == null || attribute.location === -1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst stride = mesh.instanceStride;\n\t\t\tlet offset = mesh.instanceOffsets.get(attributeName);\n\t\t\tif (offset == null) {\n\t\t\t\tthrow `Unable to find instanceOffset for ${attributeName}`;\n\t\t\t}\n\t\t\t// mat4 is really 4x vec4\n\t\t\tif (attribute.size === 4 * 4) {\n\t\t\t\tfor (let i = 0; i < 4; i++) {\n\t\t\t\t\tconst location = attribute.location + i;\n\t\t\t\t\tgl.enableVertexAttribArray(location);\n\t\t\t\t\tgl.vertexAttribPointer(location, 4, attribute.type, false, stride, offset);\n\t\t\t\t\text.vertexAttribDivisorANGLE(location, 1);\n\t\t\t\t\toffset += 4 * 4;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tunbindInstances(gl: WebGLRenderingContext) {\n\t\tconst ext = gl.getExtension('ANGLE_instanced_arrays');\n\t\tfor (const attributeName in this.instanceAttributes) {\n\t\t\tconst attribute = this.instanceAttributes[attributeName];\n\t\t\tif (attribute.location == null || attribute.location === -1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// mat4 is really 4x vec4\n\t\t\tif (attribute.size === 4 * 4) {\n\t\t\t\tfor (let i = 0; i < 4; i++) {\n\t\t\t\t\tconst location = attribute.location + i;\n\t\t\t\t\tgl.disableVertexAttribArray(location);\n\t\t\t\t\text.vertexAttribDivisorANGLE(location, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetUniform(name: string, value: boolean | number | number[] | Matrix4) {\n\t\tif (value == null) return;\n\t\tconst gl = this.gl;\n\n\t\tconst uniform = this.uniforms[name];\n\t\tif (!uniform) {\n\t\t\treturn;\n\t\t}\n\t\tswitch (uniform.type) {\n\t\t\tcase WebGLRenderingContext.BOOL:\n\t\t\t\tif (typeof value !== 'boolean') {\n\t\t\t\t\tthrow `Uniform '${name}' expected boolean but got: ${typeof value}`;\n\t\t\t\t}\n\t\t\t\tgl.uniform1i(uniform.location, value ? 1 : 0);\n\t\t\t\tbreak;\n\n\t\t\tcase WebGLRenderingContext.FLOAT:\n\t\t\t\tif (typeof value === 'number') {\n\t\t\t\t\tgl.uniform1f(uniform.location, value);\n\t\t\t\t}\n\t\t\t\telse if (Array.isArray(value) && typeof value[0] === 'number') {\n\t\t\t\t\tgl.uniform1fv(uniform.location, value);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthrow `Uniform '${name}' expected number but got: ${typeof value}`;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase WebGLRenderingContext.INT:\n\t\t\t\tif (typeof value === 'number') {\n\t\t\t\t\tgl.uniform1i(uniform.location, value);\n\t\t\t\t}\n\t\t\t\telse if (Array.isArray(value) && typeof value[0] === 'number') {\n\t\t\t\t\tgl.uniform1iv(uniform.location, value);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthrow `Uniform '${name}' expected number but got: ${typeof value}`;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase WebGLRenderingContext.FLOAT_VEC2:\n\t\t\t\tif (\n\t\t\t\t\t!Array.isArray(value) ||\n\t\t\t\t\tvalue.length !== 2 ||\n\t\t\t\t\ttypeof value[0] !== 'number' ||\n\t\t\t\t\ttypeof value[1] !== 'number'\n\t\t\t\t) {\n\t\t\t\t\tthrow `Uniform '${name}' expected an array of 2 numbers but got something else`;\n\t\t\t\t}\n\t\t\t\tgl.uniform2fv(uniform.location, value);\n\t\t\t\tbreak;\n\n\t\t\tcase WebGLRenderingContext.FLOAT_VEC3:\n\t\t\t\tif (\n\t\t\t\t\t!Array.isArray(value) ||\n\t\t\t\t\tvalue.length !== 3 ||\n\t\t\t\t\ttypeof value[0] !== 'number' ||\n\t\t\t\t\ttypeof value[1] !== 'number' ||\n\t\t\t\t\ttypeof value[2] !== 'number'\n\t\t\t\t) {\n\t\t\t\t\tthrow `Uniform '${name}' expected an array of 3 numbers but got something else`;\n\t\t\t\t}\n\t\t\t\tgl.uniform3fv(uniform.location, value);\n\t\t\t\tbreak;\n\n\t\t\tcase WebGLRenderingContext.FLOAT_VEC4:\n\t\t\t\tif (\n\t\t\t\t\t!Array.isArray(value) ||\n\t\t\t\t\tvalue.length !== 4 ||\n\t\t\t\t\ttypeof value[0] !== 'number' ||\n\t\t\t\t\ttypeof value[1] !== 'number' ||\n\t\t\t\t\ttypeof value[2] !== 'number' ||\n\t\t\t\t\ttypeof value[3] !== 'number'\n\t\t\t\t) {\n\t\t\t\t\tthrow `Uniform '${name}' expected an array of 4 numbers but got something else`;\n\t\t\t\t}\n\t\t\t\tgl.uniform4fv(uniform.location, value);\n\t\t\t\tbreak;\n\n\t\t\tcase WebGLRenderingContext.FLOAT_MAT4:\n\t\t\t\tif (!(value instanceof Matrix4)) {\n\t\t\t\t\tthrow `Uniform '${name}' expected a Matrix4 but got something else`;\n\t\t\t\t}\n\t\t\t\tgl.uniformMatrix4fv(uniform.location, false, value.toArray());\n\t\t\t\tbreak;\n\n\t\t\t// TODO other uniform types\n\t\t\tdefault:\n\t\t\t\tthrow `Unsupported uniform type: ${uniform.type}`;\n\t\t}\n\t}\n\n}\n","import { Texture, ScaleFilter } from '../texture';\nimport { RenderTexture, Attachment } from '../render_texture';\n\nconst FILTER_MAP: { [key: string]: number } = {\n\t[ScaleFilter.LINEAR]: WebGLRenderingContext.LINEAR,\n\t[ScaleFilter.NEAREST]: WebGLRenderingContext.NEAREST,\n};\n\nexport class WebGLRendererTexture {\n\tgl: WebGLRenderingContext;\n\ttexture: WebGLTexture;\n\t// Safari requries a Color texture, even if we're only rendering to a Depth texture\n\tunusedColorTexture: WebGLTexture;\n\n\tunit: number;\n\tlevel = 0;\n\tinternalFormat = WebGLRenderingContext.RGBA;\n\tsrcFormat = WebGLRenderingContext.RGBA;\n\tsrcType = WebGLRenderingContext.UNSIGNED_BYTE;\n\tminFilter = WebGLRenderingContext.LINEAR;\n\tmagFilter = WebGLRenderingContext.LINEAR;\n\n\tstatic fromTexture(gl: WebGLRenderingContext, src: Texture) {\n\t\tconst texture = new WebGLRendererTexture(gl);\n\t\ttexture.minFilter = FILTER_MAP[src.minFilter];\n\t\ttexture.magFilter = FILTER_MAP[src.magFilter];\n\n\t\tif (src instanceof RenderTexture && src.attachment === Attachment.DEPTH) {\n\t\t\ttexture.internalFormat = gl.DEPTH_COMPONENT;\n\t\t\ttexture.srcFormat = gl.DEPTH_COMPONENT;\n\t\t\ttexture.srcType = gl.UNSIGNED_INT;\n\t\t\ttexture.unusedColorTexture = gl.createTexture();\n\t\t}\n\t\treturn texture;\n\t}\n\n\tconstructor(gl: WebGLRenderingContext) {\n\t\tthis.gl = gl;\n\t\tthis.texture = gl.createTexture();\n\t}\n\n\tupload(texture: Texture, unit: number = null) {\n\t\tconst pixels = texture instanceof RenderTexture ? null : texture.pixels;\n\n\t\tif (pixels instanceof HTMLImageElement && !pixels.complete) {\n\t\t\tthrow 'Attempted to use incomplete image as texture';\n\t\t}\n\t\tthis.unit = unit;\n\n\t\tconst gl = this.gl;\n\n\t\tif (texture instanceof RenderTexture) {\n\t\t\t// Safari requries a Color texture, even if we're only rendering to a Depth texture\n\t\t\tif (this.unusedColorTexture) {\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + this.unit);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, this.unusedColorTexture);\n\t\t\t\tgl.texImage2D(\n\t\t\t\t\tgl.TEXTURE_2D,\n\t\t\t\t\t0,\n\t\t\t\t\tgl.RGBA,\n\t\t\t\t\ttexture.size,\n\t\t\t\t\ttexture.size,\n\t\t\t\t\t0,\n\t\t\t\t\tgl.RGBA,\n\t\t\t\t\tgl.UNSIGNED_BYTE,\n\t\t\t\t\tnull,\n\t\t\t\t);\n\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, this.minFilter);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, this.magFilter);\n\t\t\t}\n\n\t\t\tthis.bind();\n\t\t\tgl.texImage2D(\n\t\t\t\tgl.TEXTURE_2D,\n\t\t\t\tthis.level,\n\t\t\t\tthis.internalFormat,\n\t\t\t\ttexture.size,\n\t\t\t\ttexture.size,\n\t\t\t\t0,\n\t\t\t\tthis.srcFormat,\n\t\t\t\tthis.srcType,\n\t\t\t\tnull,\n\t\t\t);\n\n\t\t}\n\t\telse {\n\t\t\tthis.bind();\n\t\t\tgl.texImage2D(\n\t\t\t\tgl.TEXTURE_2D,\n\t\t\t\tthis.level,\n\t\t\t\tthis.internalFormat,\n\t\t\t\tthis.srcFormat,\n\t\t\t\tthis.srcType,\n\t\t\t\tpixels,\n\t\t\t);\n\t\t}\n\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, this.minFilter);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, this.magFilter);\n\t}\n\n\tbind(): number {\n\t\tif (this.unit == null) {\n\t\t\tthrow `Cannot bind texture that hasn't been uploaded`;\n\t\t}\n\t\tconst gl = this.gl;\n\t\tgl.activeTexture(gl.TEXTURE0 + this.unit);\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.texture);\n\t\treturn this.unit;\n\t}\n\n\tunbind() {\n\t\tif (this.unit == null) {\n\t\t\tthrow `Cannot unbind texture that hasn't been uploaded`;\n\t\t}\n\t\tconst gl = this.gl;\n\t\tgl.activeTexture(gl.TEXTURE0 + this.unit);\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t}\n}\n","import { Actor, ActorInstance } from './actor';\nimport { Texture } from './texture';\nimport { Renderer } from './renderer';\nimport { Color } from './material';\nimport { StaticMesh } from './components/static_mesh';\nimport { Light as LightComponent } from './components/light';\nimport { UniformValues } from './shader';\nimport { RenderTexture, Attachment } from './render_texture';\nimport { Light } from './light';\nimport { normalize } from './geom';\n\nexport class Scene {\n\tactors: Actor[] = [];\n\ttextures: Map<number, Texture> = new Map();\n\trenderer: Renderer;\n\tbackgroundColor: Color = [0.0, 0.0, 0.0, 1.0];\n\tshadowMap: RenderTexture;\n\tlight: Light;\n\tlights: Actor[] = [];\n\tcastShadows: false;\n\tuniforms?: UniformValues = {\n\t\tuShadowMap: null,\n\t\tuLight: null,\n\t\tuLightDir: null,\n\t};\n\n\tconstructor(renderer: Renderer) {\n\t\tthis.renderer = renderer;\n\t}\n\n\taddActor(actor: Actor): number {\n\t\tconst { children } = actor;\n\n\t\tconst uploadActor = (actor: Actor) => {\n\t\t\t// Keep track of lights\n\t\t\tif (actor.hasComponentOfType(LightComponent)) {\n\t\t\t\tthis.lights.push(actor);\n\t\t\t}\n\n\t\t\t// Upload the mesh\n\t\t\tfor (const component of actor.getComponentsOfType(StaticMesh)) {\n\t\t\t\tthis.renderer.uploadMesh(component.mesh);\n\t\t\t}\n\n\t\t\t// Upload textures\n\t\t\tif (actor.material?.texture) {\n\t\t\t\tthis.addTexture(actor.material.texture);\n\t\t\t}\n\t\t\tif (actor.material?.normalMap) {\n\t\t\t\tthis.addTexture(actor.material.normalMap);\n\t\t\t}\n\t\t\tif (actor.material?.specularMap) {\n\t\t\t\tthis.addTexture(actor.material.specularMap);\n\t\t\t}\n\t\t\tif (actor.material?.displacementMap) {\n\t\t\t\tthis.addTexture(actor.material.displacementMap);\n\t\t\t}\n\n\t\t\tthis.uploadActorInstances(actor);\n\t\t};\n\n\t\tuploadActor(actor);\n\n\t\tfor (const child of children) {\n\t\t\tuploadActor(child);\n\t\t}\n\n\n\t\tthis.actors.push(actor);\n\t\treturn this.actors.length - 1;\n\t}\n\n\tuploadActorInstances(actor: Actor) {\n\t\tconst { hasInstances } = actor;\n\t\tif (!hasInstances) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = Array.from(actor.instances.values()).map((i: ActorInstance) => i.data)\n\n\t\tfor (const component of actor.getComponentsOfType(StaticMesh)) {\n\t\t\tthis.renderer.uploadMeshInstances(component.mesh, data);\n\t\t}\n\t}\n\n\taddTexture(texture: Texture): number {\n\t\tconst id = this.renderer.uploadTexture(texture);\n\t\tthis.textures.set(id, texture);\n\t\treturn id;\n\t}\n\n\tgetIdOfTexture(texture: Texture): number | null {\n\t\tfor (let [id, value] of this.textures.entries()) {\n\t\t\tif (value === texture) return id;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tupdateTexture(textureOrId: Texture | number) {\n\t\tif (typeof textureOrId === 'number') {\n\t\t\tconst texture = this.textures.get(textureOrId);\n\t\t\tif (!texture) {\n\t\t\t\tthrow `Unable to find texture ${textureOrId}`;\n\t\t\t}\n\t\t\tthis.renderer.uploadTexture(texture, textureOrId);\n\t\t} else {\n\t\t\tconst id = this.getIdOfTexture(textureOrId);\n\t\t\tif (id == null) {\n\t\t\t\tthrow `Attempted to upload an unknown texture`;\n\t\t\t}\n\t\t\tthis.renderer.uploadTexture(textureOrId, id);\n\t\t}\n\t}\n\n\tbindTexture(textureOrId: Texture | number): number {\n\t\tconst texture = typeof textureOrId === 'number' ? this.textures.get(textureOrId) : textureOrId;\n\t\tif (!texture) {\n\t\t\tthrow `Unable to find texture`;\n\t\t}\n\t\treturn this.renderer.bindTexture(texture);\n\t}\n\n\tunbindTexture(textureOrId: Texture | number) {\n\t\tconst texture = typeof textureOrId === 'number' ? this.textures.get(textureOrId) : textureOrId;\n\t\tif (!texture) {\n\t\t\tthrow `Unable to find texture`;\n\t\t}\n\t\tthis.renderer.unbindTexture(texture);\n\t}\n\n\tasync draw(): Promise<number> {\n\t\tif (this.castShadows) {\n\t\t\tthis.updateShadowMap();\n\t\t}\n\t\tthis.updateLightView();\n\t\treturn await this.renderer.drawScene(this);\n\t}\n\n\tprotected createShadowMap() {\n\t\tconst gl = (this.renderer as any).gl as WebGLRenderingContext;\n\n\t\tconst ext = gl.getExtension('WEBGL_depth_texture');\n\t\tif (!ext) {\n\t\t\tthrow `WEBGL_depth_texture extension is not supported`;\n\t\t}\n\n\t\tthis.shadowMap = new RenderTexture(1024, Attachment.DEPTH);\n\t}\n\n\tprotected updateShadowMap() {\n\t\tif (!this.light) return;\n\t\tif (!this.shadowMap) this.createShadowMap();\n\n\t\tconst hiddenActors = [];\n\t\tfor (const actor of this.actors) {\n\t\t\tif (actor.visible && actor.material && !actor.material.castsShadows) {\n\t\t\t\tactor.visible = false;\n\t\t\t\thiddenActors.push(actor);\n\t\t\t}\n\t\t}\n\t\tthis.disableShadows();\n\t\tconst oldCamera = this.renderer.camera;\n\t\tthis.renderer.camera = this.light;\n\t\tthis.renderer.drawScene(this, this.shadowMap);\n\t\tthis.renderer.camera = oldCamera;\n\t\tthis.enableShadows();\n\t\tfor (const actor of hiddenActors) {\n\t\t\tactor.visible = true;\n\t\t}\n\t}\n\n\tprotected updateLightView() {\n\t\tif (!this.light) return;\n\t\tconst proj = this.light.projection.clone();\n\t\tconst view = this.light.view.inverse();\n\t\tconst viewProj = proj.multiply(view);\n\t\tconst forward = this.light.view.multiplyVector4([0.0, 0.0, 1.0, 0.0]);\n\t\tconst lightDir = normalize([forward[0], forward[1], forward[2]]);\n\n\t\tthis.uniforms.uLightDir = lightDir;\n\t\tthis.uniforms.uLight = viewProj;\n\t}\n\n\tprivate enableShadows() {\n\t\tthis.uniforms.uShadowMap = this.bindTexture(this.shadowMap);\n\t}\n\n\tprivate disableShadows() {\n\t\tthis.unbindTexture(this.shadowMap);\n\t\tthis.uniforms.uShadowMap = null;\n\t}\n}\n","import { Matrix4 } from './geom';\n\n// TODO make a shader abstraction\nexport { WebGLShader as Shader, ShaderOptions } from './renderer/webgl_shader';\n\nexport type UniformValues = {\n\t[key: string]: boolean | number | number[] | Matrix4,\n};\n","import { Shader } from '../shader';\nimport vertexSource from './material.vert.glsl';\nimport vertexSourceSphere from './material_sphere.vert.glsl';\nimport fragmentSource from './material.frag.glsl';\nimport fragmentSourceSphere from './material_sphere.frag.glsl';\n\nconst MAX_LIGHT_COUNT = 8;\n\ntype UniformMap = Shader['uniforms'];\n\nexport class MaterialShader extends Shader {\n\tmake(gl: WebGLRenderingContext, vertSource?: string, fragSource?: string) {\n\t\tconst lightUniforms: UniformMap = {\n\t\t\tuLightCount: {\n\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t},\n\t\t};\n\t\tfor (let i = 0; i < MAX_LIGHT_COUNT; i++) {\n\t\t\tconst uniformName = `uLights[${i}]`;\n\t\t\t// @prettier-ignore\n\t\t\tlightUniforms[`${uniformName}.position`]  = { type: WebGLRenderingContext.FLOAT_VEC3 };\n\t\t\tlightUniforms[`${uniformName}.ambient`]   = { type: WebGLRenderingContext.FLOAT_VEC3 };\n\t\t\tlightUniforms[`${uniformName}.diffuse`]   = { type: WebGLRenderingContext.FLOAT_VEC3 };\n\t\t\tlightUniforms[`${uniformName}.specular`]  = { type: WebGLRenderingContext.FLOAT_VEC3 };\n\t\t\tlightUniforms[`${uniformName}.constant`]  = { type: WebGLRenderingContext.FLOAT };\n\t\t\tlightUniforms[`${uniformName}.linear`]    = { type: WebGLRenderingContext.FLOAT };\n\t\t\tlightUniforms[`${uniformName}.quadratic`] = { type: WebGLRenderingContext.FLOAT };\n\t\t}\n\n\t\tsuper.make(gl, vertSource || vertexSource, fragSource || fragmentSource, {\n\t\t\tattributes: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t\tsize: 4,\n\t\t\t\t},\n\t\t\t\tnormal: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t\tsize: 3,\n\t\t\t\t},\n\t\t\t\tuv: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t\tsize: 2,\n\t\t\t\t},\n\t\t\t},\n\t\t\tuniforms: {\n\t\t\t\t...lightUniforms,\n\t\t\t\t// uMaterial\n\t\t\t\t\"uMaterial.color\": {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT_VEC4,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.castsShadows\": {\n\t\t\t\t\ttype: WebGLRenderingContext.BOOL,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.receivesShadows\": {\n\t\t\t\t\ttype: WebGLRenderingContext.BOOL,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.displacementMultiplier\": {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.hasTexture\": {\n\t\t\t\t\ttype: WebGLRenderingContext.BOOL,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.hasNormalMap\": {\n\t\t\t\t\ttype: WebGLRenderingContext.BOOL,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.hasSpecularMap\": {\n\t\t\t\t\ttype: WebGLRenderingContext.BOOL,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.hasDisplacementMap\": {\n\t\t\t\t\ttype: WebGLRenderingContext.BOOL,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.texture\": {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.normalMap\": {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.specularMap\": {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.displacementMap\": {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t\t\"uMaterial.emissive\": {\n\t\t\t\t\ttype: WebGLRenderingContext.BOOL,\n\t\t\t\t},\n\t\t\t\tuTexture: {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t\tuNormalMap: {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t\tuLight: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT_MAT4,\n\t\t\t\t},\n\t\t\t\tuLightDir: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT_VEC3,\n\t\t\t\t},\n\t\t\t\tuShadowMap: {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}\n\nexport class SphereMaterialShader extends MaterialShader {\n\tmake(gl: WebGLRenderingContext) {\n\t\tsuper.make(gl, vertexSourceSphere, fragmentSourceSphere);\n\t}\n}\n","import { Shader } from '../shader';\nimport vertexSource from './simple.vert.glsl';\nimport fragmentSource from './simple.frag.glsl';\n\nexport class SimpleShader extends Shader {\n\tmake(gl: WebGLRenderingContext) {\n\t\tsuper.make(gl, vertexSource, fragmentSource, {\n\t\t\tattributes: {\n\t\t\t\tcolor: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t\tsize: 4,\n\t\t\t\t},\n\t\t\t\tnormal: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t\tsize: 3,\n\t\t\t\t},\n\t\t\t\tuv: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t\tsize: 2,\n\t\t\t\t},\n\t\t\t},\n\t\t\tuniforms: {\n\t\t\t\tuLight: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT_MAT4,\n\t\t\t\t},\n\t\t\t\tuLightDir: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT_VEC3,\n\t\t\t\t},\n\t\t\t\tuShadowMap: {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Shader } from '../shader';\nimport vertexSource from './sprite.vert.glsl';\nimport fragmentSource from './sprite.frag.glsl';\n\nexport class SpriteShader extends Shader {\n\tmake(gl: WebGLRenderingContext) {\n\t\tsuper.make(gl, vertexSource, fragmentSource, {\n\t\t\tattributes: {\n\t\t\t\tuv: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t\tsize: 2,\n\t\t\t\t},\n\t\t\t},\n\t\t\tuniforms: {\n\t\t\t\tuSampler: {\n\t\t\t\t\ttype: WebGLRenderingContext.INT,\n\t\t\t\t},\n\t\t\t\tuContrast: {\n\t\t\t\t\ttype: WebGLRenderingContext.FLOAT,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}\n","export enum ScaleFilter {\n\tLINEAR,\n\tNEAREST,\n}\n\nexport interface TextureOptions {\n\tminFilter?: ScaleFilter;\n\tmagFilter?: ScaleFilter;\n}\n\nexport class Texture {\n\tpixels: ImageData | HTMLImageElement;\n\tminFilter = ScaleFilter.LINEAR;\n\tmagFilter = ScaleFilter.LINEAR;\n\n\tconstructor(imageOrURL?: HTMLImageElement | ImageData | string, options?: TextureOptions) {\n\t\tthis.putPixels(new ImageData(new Uint8ClampedArray([255, 0, 255, 255]), 1, 1));\n\t\tif (options?.minFilter) {\n\t\t\tthis.minFilter = options.minFilter\n\t\t}\n\t\tif (options?.magFilter) {\n\t\t\tthis.magFilter = options.magFilter\n\t\t}\n\n\t\tif (imageOrURL) {\n\t\t\tif (typeof imageOrURL === 'string') {\n\t\t\t\tconst image = new Image();\n\t\t\t\timage.src = imageOrURL;\n\t\t\t\tthis.putImage(image);\n\t\t\t} else if (imageOrURL instanceof HTMLImageElement) {\n\t\t\t\tthis.putImage(imageOrURL);\n\t\t\t} else {\n\t\t\t\tthis.putPixels(imageOrURL);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic async fromUrl(url: string, options?: TextureOptions): Promise<Texture> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst image = new Image();\n\t\t\timage.src = url;\n\t\t\timage.addEventListener('load', () => {\n\t\t\t\tresolve(new Texture(image, options));\n\t\t\t});\n\t\t\timage.addEventListener('error', (e) => {\n\t\t\t\treject(e);\n\t\t\t});\n\t\t});\n\t}\n\n\tputImage(image: HTMLImageElement) {\n\t\tif (image.complete) {\n\t\t\tthis.putPixels(image);\n\t\t} else {\n\t\t\t// Image hasn't puted yet; wait for it\n\t\t\timage.addEventListener('load', () => {\n\t\t\t\tthis.putImage(image);\n\t\t\t});\n\t\t}\n\t}\n\n\tputPixels(pixels: ImageData | HTMLImageElement) {\n\t\tif (pixels instanceof HTMLImageElement && !pixels.complete) {\n\t\t\tthrow 'Attempted to use incomplete image as texture';\n\t\t}\n\n\t\tthis.pixels = pixels;\n\t}\n\n\tget data(): Uint8ClampedArray {\n\t\tif (this.pixels instanceof ImageData) {\n\t\t\treturn this.pixels.data;\n\t\t}\n\t\tthrow `Can't get data of an HTMLImageElement`;\n\t}\n\n\tget width(): number {\n\t\treturn this.pixels.width;\n\t}\n\n\tget height(): number {\n\t\treturn this.pixels.height;\n\t}\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(\"./src/index.ts\");\n"],"sourceRoot":""}